/*
Copyright (c) 2019 Daybrush
name: @scenejs/timeline
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/scenejs-timeline.git
version: 0.0.5
*/
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@daybrush/utils"),require("@daybrush/drag"),require("@egjs/axes"),require("keycon"),require("data-dom")):"function"==typeof define&&define.amd?define(["@daybrush/utils","@daybrush/drag","@egjs/axes","keycon","data-dom"],n):(e=e||self).Timeline=n(e.utils,e.utils,e.eg.Axes,e.KeyController,e.DataDOM)}(this,function(d,h,o,r,c){"use strict";var f="scenejs_timeline_",u='\n.timeline {\n  position: relative;\n  font-size: 0;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n}\n.header_area, .scroll_area {\n   width: 100%;\n   position: relative;\n  display: flex;\n  -webkit-align-items: flex-start;\n  align-items: flex-start;\n}\n.header_area {\n  position: relative;\n  z-index: 10;\n  top: 0;\n  height: 30px;\n  min-height: 30px;\n}\n.header_area .keyframes {\n  padding: 0px;\n}\n.header_area .properties_area,\n.header_area .keyframes_area,\n.header_area .values_area,\n.header_area .keyframes_scroll_area {\n    height: 100%;\n}\n.header_area .property, .header_area .value, .header_area .keyframes {\n  height: 100%;\n}\n.header_area .property {\n    line-height: 30px;\n}\n.header_area .value {\n    text-align: center;\n    color: #fff;\n    line-height: 30px;\n    font-weight: bold;\n    font-size: 20px;\n}\n.header_area .keyframes_area::-webkit-scrollbar {\n    display: none; // Safari and Chrome\n}\n.header_area .keyframe_cursor {\n    position: absolute;\n    border-top: 10px solid #4af;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    width: 0;\n    height: 0;\n    bottom: 0;\n    top: auto;\n    background: none;\n    cursor: pointer;\n}\n.control_area .keyframes {\n    padding-left: 10px;\n}\n.play_control_area {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n.play_control_area .control {\n    position: relative;\n    display: inline-block;\n    vertical-align: middle;\n    color: white;\n    margin: 0px 15px;\n}\n.play {\n    border-left: 14px solid white;\n    border-top: 8px solid transparent;\n    border-bottom: 8px solid transparent;\n}\n.pause {\n    border-left: 4px solid #fff;\n    border-right: 4px solid #fff;\n    width: 6px;\n    height: 16px;\n}\n.prev {\n    border-right: 10px solid white;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n}\n.prev:before {\n    position: absolute;\n    content: "";\n    width: 3px;\n    height: 10px;\n    top: 0;\n    right: 100%;\n    transform: translate(0, -50%);\n    background: white;\n}\n.next {\n    border-left: 10px solid white;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n}\n.next:before {\n    position: absolute;\n    content: "";\n    width: 3px;\n    height: 10px;\n    top: 0;\n    transform: translate(0, -50%);\n    background: white;\n}\n.keytime {\n  position: relative;\n  display: inline-block;\n  height: 100%;\n  font-size: 13px;\n  font-weight: bold;\n  color: #777;\n}\n.keytime:last-child {\n  max-width: 0px;\n}\n.keytime span {\n  position: absolute;\n  top: 2px;\n  left: 0;\n  display: inline-block;\n  transform: translate(-50%);\n  color: #eee;\n}\n.keytime .graduation {\n  position: absolute;\n  bottom: 0;\n  width: 1px;\n  height: 10px;\n  background: #777;\n  transform: translate(-50%);\n}\n.keytime .graduation.half {\n  left: 50%;\n  height: 7px;\n}\n.keytime .graduation.quarter {\n  left: 25%;\n  height: 5px;\n}\n.keytime .graduation.quarter3 {\n  left: 75%;\n  height: 5px;\n}\n.scroll_area {\n  position: relative;\n  width: 100%;\n  height: calc(100% - 60px);\n  overflow: auto;\n}\n.properties_area, .keyframes_area, .values_area {\n  display: inline-block;\n  position: relative;\n  font-size: 16px;\n  overflow: auto;\n}\n\n.properties_area::-webkit-scrollbar, .keyframes_area::-webkit-scrollbar {\n    display: none; // Safari and Chrome\n}\n.properties_area {\n  width: 30%;\n  max-width: 200px;\n  box-sizing: border-box;\n}\n.values_area {\n    width: 50px;\n    min-width: 50px;\n    display: inline-block;\n    border-right: 1px solid #999;\n    box-sizing: border-box;\n}\n.value input {\n    appearance: none;\n    -webkit-appearance: none;\n    outline: none;\n    position: relative;\n    display: block;\n    width: 100%;\n    height: 100%;\n    background: transparent;\n    color: #4af;\n    font-weight: bold;\n    background: none;\n    border: 0;\n    box-sizing: border-box;\n    text-align: center;\n}\n.alt .value input {\n    cursor: ew-resize;\n}\n.value[data-object="1"] input {\n    display: none;\n}\n.properties_scroll_area {\n  display: inline-block;\n  min-width: 100%;\n}\n.keyframes_area {\n  flex: 1;\n}\n.keyframes_scroll_area {\n  position: relative;\n  min-width: 300px;\n}\n.keyframes, .property, .value {\n  position: relative;\n  height: 25px;\n  border-bottom: 1px solid #777;\n  box-sizing: border-box;\n  white-space: nowrap;\n  background: rgba(90, 90, 90, 0.7);\n  z-index: 1;\n}\n\n.property {\n  line-height: 25px;\n  padding-left: 10px;\n  box-sizing: border-box;\n  font-size: 13px;\n  font-weight: bold;\n  color: #eee;\n}\n.time_area {\n    font-size: 13px;\n    color: #4af;\n    line-height: 30px;\n    font-weight: bold;\n    height: 100%;\n    line-height: 30px;\n    border: 0;\n    background: transparent;\n    outline: 0;\n}\n.time_area:after {\n    content: "s";\n}\n.property .arrow {\n    position: relative;\n    display: inline-block;\n    margin-right: 5px;\n    width: 0;\n    vertical-align: middle;\n    cursor: pointer;\n    border-top: 6px solid #eee;\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n}\n.property[data-fold="1"] .arrow {\n    border-top: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-right: 0;\n    border-left: 6px solid #eee;\n    margin-left: 2px;\n}\n.property[data-object="0"] .arrow {\n    display: none;\n}\n.property.fold, .keyframes.fold, .value.fold {\n    display: none;\n}\n.property.select, .value.select, .keyframes.select {\n    background: rgba(120, 120, 120, 0.7);\n}\n.keyframes {\n\n}\n.keyframe_line {\n  position: absolute;\n  height: 8px;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  background: #666;\n  z-index: 0;\n}\n.keyframe {\n  position: absolute;\n  font-size: 0px;\n  width: 12px;\n  height: 12px;\n  top: 0px;\n  bottom: 0px;\n  margin: auto;\n  background: #fff;\n  border: 2px solid #383838;\n  border-radius: 2px;\n  box-sizing: border-box;\n  transform: translate(-50%) rotate(45deg);\n  z-index: 1;\n  cursor: pointer;\n}\n.select .keyframe {\n    border-color: #555;\n}\n.keyframe.select {\n    background: #4af;\n}\n.keyframes_container, .line_area {\n  position: relative;\n  width: calc(100% - 30px);\n  left: 15px;\n  height: 100%;\n}\n.line_area {\n  position: absolute;\n  top: 0;\n  z-index: 0;\n}\n.keyframe_cursor {\n  position: absolute;\n  top: 0;\n  z-index: 1;\n  background: #4af;\n  width: 1px;\n  height: 100%;\n  left: 15px;\n  transform: translate(-50%);\n}\n.division_line {\n  position: absolute;\n  background: #333;\n  width: 1px;\n  height: 100%;\n  transform: translate(-50%);\n}\n'.replace(/\.([^{,\s\d.]+)/g,"."+f+"$1");function m(e,n,t){var r=(""+e).length,i=[];t&&i.push(e);for(var a=r;a<n;++a)i.push(0);return t||i.push(e),i.join("")}function p(e,n){for(var t in n)e.style[t]=n[t]}function y(n,e){return e.findIndex(function(e){return e.dataset.property===n})}function v(e){var n=e.selector,t=e.dataset,r=e.attr,i=e.style,a=e.html,o=n.match(/\.([^.#\s])+/g)||[],s=(n.match(/^[^.#\s]+/g)||[])[0]||"div",l=(n.match(/#[^.#\s]+/g)||[])[0]||"",c=document.createElement(s);if(l&&(c.id=l.replace(/^#/g,"")),c.className=o.map(function(e){return f+e.replace(/^\./g,"")}).join(" "),t)for(var u in t)c.setAttribute("data-"+u,t[u]);if(r)for(var u in r)c.setAttribute(u,r[u]);return i&&p(c,i),a&&(c.innerHTML=a),c}function g(e,n){var t=n.dataset,r=n.attr,i=n.style,a=n.html,o=n.element;if(t)for(var s in t)o.setAttribute("data-"+s,t[s]);if(r)for(var s in r)o.setAttribute(s,r[s]);i&&p(o,i),e.html!==n.html&&(o.innerHTML=a)}function k(n){return"object"==typeof n?Array.isArray(n)?"["+n.join(", ")+"]":"{"+function(e){var n=[];for(var t in e)n.push(t);return n}(n).map(function(e){return e+": "+k(n[e])}).join(", ")+"}":n}function x(e){var l={};return e.forEach(function(n){var s=n.getDelay();n.times.forEach(function(o){var e=n.getFrame(o);!function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[e.length-1],i=e.slice(0,-1),a=i.join("///");a&&(l[a]||(l[a]=[]),l[a].push([s+o,r]));"object"==typeof r&&Object.keys(r).forEach(function(e){n.apply(void 0,i.concat([e,r[e]]))})}(n.getId(),e.get())})}),l}function b(e,n){for(var t=e;t&&t!==document.body;){if(n(t))return t;t=t.parentNode}return null}function w(e,n){return d.hasClass(e,f+n)}function _(e,n){return d.addClass(e,f+n)}function E(e,n){return d.removeClass(e,f+n)}function l(e,n){var t,r=n.split("///"),i=r.length,a=e;for(t=0;t<i&&!a.constructor.prototype.getFrame;++t)a=e.getItem(r[t]);return{item:a,names:r.slice(0,t),properties:r.slice(t)}}function A(e,n){for(var t=e.length,r=0;r<t;++r){var i=e[r].getBoundingClientRect(),a=i.top,o=a+i.height;if(a<=n&&n<o)return r}return-1}var T=0,z=-1,C=-1;function L(n,e,t,r){return{ref:function(e){n.keyframesAreas[0]=e},selector:".keyframes_area",children:{style:{minWidth:50*r+"px",width:Math.min(t?r/t:1,2)*e*100+"%"},dataset:{width:Math.min(t?r/t:1,2)},ref:function(e){n.keyframesScrollAreas[0]=e},selector:".keyframes_scroll_area",children:{ref:function(e){n.cursors=[]},selector:".keyframes",children:[{ref:function(e){n.keytimesContainer=e},selector:".keyframes_container",children:function(e){for(var n=[],t=0;t<=e;++t)n.push({key:t,dataset:{time:t},selector:".keytime",style:{width:100/e+"%"},children:[{selector:"span",html:""+t},{selector:".graduation.start"},{selector:".graduation.quarter"},{selector:".graduation.half"},{selector:".graduation.quarter3"}]});return n}(r)},{selector:".keyframe_cursor",ref:function(e){n.cursors[0]=e}}]}}}}function s(n,e,t,r,i){var a=Math.min(r?i/r:1,2);return{ref:function(e){n.keyframesAreas[1]=e},selector:".keyframes_area",children:{style:{minWidth:50*i+"px",width:a*t*100+"%"},dataset:{width:a},ref:function(e){n.keyframesScrollAreas[1]=e},selector:".keyframes_scroll_area",children:function(n,e,t){return e.concat([{key:"cursor",selector:".keyframe_cursor",ref:function(e){n.cursors[1]=e}},{key:"lineArea",ref:function(e){n.lineArea=e},selector:".line_area",children:function(e){for(var n=[],t=0;t<=e;++t)n.push({key:t,selector:".division_line",style:{left:100/e*t+"%"}});return n}(t)}])}(n,e,i)}}}function j(o,s){var l=[];return o.map(function(e,n){var t=e[0],r=k(e[1]);if(o[n+1]){var i=o[n+1],a=i[0];r!==k(i[1])&&l.push({selector:".keyframe_line",key:t+","+a,dataset:{time:t+","+a,from:t,to:a},style:{left:t/s*100+"%",width:(a-t)/s*100+"%"}})}return{key:t,selector:".keyframe",dataset:{time:t,value:r},style:{left:t/s*100+"%"},html:t+" "+r}}).concat(l)}function D(n,e,t,r,i){var a=function(t,e,n){var r=[];for(var i in e){var a=j(e[i],n);r.push({ref:function(e,n){t.keyframesList[n]=e,t.keyframesContainers[n]=e.children},selector:".keyframes",key:i,dataset:{property:i},children:{selector:".keyframes_container",children:a}})}return r}(n,e,i);return{ref:function(e){n.scrollArea=e,n.keyframesList=[],n.keyframesContainers=[]},selector:".scroll_area",children:[{ref:function(e){n.propertiesAreas[1]=e,n.properties=[]},selector:".properties_area",children:[{selector:".properties_scroll_area",children:function(a,e){var o=[],n=function(e){var n=e.split("///"),t=n.length,r=n[t-1];o.push({ref:function(e,n){a.properties[n]=e},key:e,selector:".property",dataset:{id:r,property:e,parent:n[t-2]||"",object:"0",item:n[0]},style:{paddingLeft:10+20*(t-1)+"px"},children:[{selector:".arrow"},{selector:"span",html:r}]});var i=n.slice(0,-1).join("///");o.forEach(function(e){var n=e.dataset;n.property===i&&(n.object="1")})};for(var t in e)n(t);return o}(n,e)}]},{ref:function(e){n.valuesArea=e,n.values=[]},selector:".values_area",children:function(t,e){var n=[];for(var r in e){var i=e[r],a=i[0]&&d.isObject(i[0][1]);n.push({ref:function(e,n){t.values[n]=e},key:r,selector:".value",dataset:{property:r,object:a?"1":"0"},children:{selector:"input",attr:{value:i[0]?i[0][1]:""}}})}return n}(n,e)},s(n,a,t,r,i)]}}var P=!1;return function(){function e(e,n){this.maxTime=0,this.selectedProperty="",this.selectedTime=-1,this.ids={},e.finish(),this.scene=e,this.initStructure(e,n),this.initEditor(),this.initScroll(),this.initWheelZoom(),this.initDragKeyframes(),this.initClickProperty(),this.initController(),this.initDragValues(),this.initKeyController(),e.setTime(0)}var n=e.prototype;return n.getElement=function(){return this.structure.element},n.prev=function(){this.scene.setTime(this.scene.getTime()-.05)},n.next=function(){this.scene.setTime(this.scene.getTime()+.05)},n.finish=function(){this.scene.finish()},n.togglePlay=function(){var e=this.scene;"running"===e.getPlayState()?e.pause():e.play()},n.initController=function(){var n=this,i=this.ids,e=this.ids.playBtn.element,a=this.scene;e.addEventListener("click",function(e){n.togglePlay(),e.preventDefault()}),i.prevBtn.element.addEventListener("click",function(e){n.prev(),e.preventDefault()}),i.nextBtn.element.addEventListener("click",function(e){n.next(),e.preventDefault()}),a.on("play",function(){_(e,"pause"),E(e,"play")}),a.on("paused",function(){_(e,"play"),E(e,"pause")}),new r(i.timeArea.element).keydown(function(e){!e.isToggle&&e.inputEvent.stopPropagation()}).keyup(function(e){!e.isToggle&&e.inputEvent.stopPropagation()}).keyup("enter",function(e){var n=i.timeArea.element.value,t=/(\d+):(\d+):(\d+)/g.exec(n);if(t){var r=60*parseFloat(t[1])+parseFloat(t[2])+parseFloat("0."+t[3]);a.setTime(r)}})},n.initKeyController=function(){var n=this,e=this.ids;window.addEventListener("blur",function(){E(e.timeline.element,"alt")}),this.keycon=(new r).keydown("space",function(e){e.inputEvent.preventDefault()}).keydown("left",function(e){n.prev()}).keydown("right",function(e){n.next()}).keyup("backspace",function(){n.removeKeyframe(n.selectedProperty,n.scene.getTime())}).keydown("alt",function(){_(e.timeline.element,"alt")}).keyup("alt",function(){E(e.timeline.element,"alt")}).keyup("esc",function(){n.finish()}).keyup("space",function(){n.togglePlay()})},n.initStructure=function(e,n){var t,r=Math.ceil(e.getDuration()),i=x(e),a=Math.ceil(r),o=a+5,s=this.ids;this.maxTime=o,P||(t={selector:"style.style",html:u},P=!0);var l={selector:".timeline",ref:function(e){s.timeline=e},children:[t,function(n){return{selector:".header_area.control_area",children:[{selector:".properties_area",children:{selector:".property"}},{selector:".values_area",children:{selector:".value"}},{selector:".keyframes_area",children:{selector:".keyframes",children:[{selector:"input.time_area",ref:function(e){n.timeArea=e},html:"???"},{selector:".play_control_area",children:[{ref:function(e){n.prevBtn=e},selector:".control.prev"},{ref:function(e){n.playBtn=e},selector:".control.play"},{ref:function(e){n.nextBtn=e},selector:".control.next"}]}]}}]}}(s),function(n,e,t,r){return{selector:".header_area",ref:function(e){n.keyframesScrollAreas=[],n.keyframesAreas=[],n.propertiesAreas=[]},children:[{ref:function(e){n.propertiesAreas[0]=e},selector:".properties_area",children:[{selector:".property",html:"Name"}]},{selector:".values_area",children:{selector:".value",html:"+"}},L(n,e,t,r)]}}(s,1,a,o),D(s,i,1,a,o)]};this.datadom=new c(v,g),this.structure=this.datadom.render(l,n)},n.initScroll=function(){var e=this.ids.keyframesAreas,n=!1,t=e[0].element,r=e[1].element;t.addEventListener("scroll",function(){n?n=!1:(n=!0,r.scrollLeft=t.scrollLeft)}),r.addEventListener("scroll",function(){n?n=!1:(n=!0,t.scrollLeft=r.scrollLeft)})},n.initWheelZoom=function(){var t=this,r=this.ids,e=r.keyframesScrollAreas,n=e[0].element,i=e[1].element,a=new o({zoom:{range:[1,1/0]}},{},{zoom:1});a.connect("zoom",new o.PinchInput(i,{scale:.1,hammerManagerOptions:{touchAction:"auto"}})),a.on("hold",function(e){e.inputEvent&&e.inputEvent.preventDefault()}),a.on("change",function(e){var n=r.keyframesScrollAreas[0].dataset.width,t=e.pos.zoom*n*100;r.keyframesScrollAreas.forEach(function(e){e.element.style.width=t+"%"}),e.inputEvent&&e.inputEvent.preventDefault()}),this.axes=a,n.addEventListener("wheel",function(e){var n=e.deltaY;a.setBy({zoom:n/5e3}),!e.deltaX&&e.preventDefault()}),d.addEvent(i,"wheel",function(e){if(t.keycon.altKey){e.preventDefault();var n=e.deltaY;a.setBy({zoom:n/5e3})}})},n.select=function(e,n){var t=this.selectedProperty,r=this.selectedTime,i=this.ids,a=i.values,o=i.properties,s=i.keyframesList;if(this.selectedProperty=e,t){var l=y(t,o);if(E(o[l].element,"select"),E(a[l].element,"select"),E(s[l].element,"select"),0<=r)(u=i.keyframesContainers[l].children).forEach(function(e){e.dataset.time===r&&E(e.element,"select")}),this.selectedTime=-1}if(e){document.activeElement&&document.activeElement.blur();var c=y(e,o);if(_(o[c].element,"select"),_(a[c].element,"select"),_(s[c].element,"select"),0<=n){var u=i.keyframesContainers[c].children;console.log(i.keyframesContainers,c),u.forEach(function(e){console.log(e.dataset.time,n),e.dataset.time===n&&_(e.element,"select")}),this.selectedTime=n}}},n.initClickProperty=function(){var a=this,o=this.ids;o.propertiesAreas[1].element.addEventListener("click",function(e){var n=o.properties.map(function(e){return e.element}),t=(n.length,b(e.target,function(e){return w(e,"arrow")})),r=b(e.target,function(e){return w(e,"property")});if(r){var i=n.indexOf(r);-1!==i&&(t||a.select(n[i].dataset.property))}})},n.setInputs=function(e){var n=this.ids.valuesArea.element;for(var t in e)n.querySelector('[data-property="'+t+'"] input').value=e[t]},n.moveCursor=function(e){var n=this.ids.cursors,t=this.maxTime,r="calc("+100*e/t+"% + "+(15-30*e/t)+"px)";n.forEach(function(e){e.element.style.left=r})},n.initDragKeyframes=function(){var s=this,l=this.ids,i=l.scrollArea,a=l.timeArea,e=l.cursors,o=l.keyframesAreas,c=l.keyframesScrollAreas,u=this.scene;u.on("animate",function(e){var n=e.time;s.moveCursor(n),s.setInputs(function e(n,t){for(var r in void 0===t&&(t={}),n){var i=n[r];if(d.isObject(i)){var a=e(i.constructor.prototype.toCSS?i.get():i);for(var o in a)t[r+"///"+o]=a[o]}else t[r]=i}return t}(e.frames));var t=m(Math.floor(n/60),2),r=m(Math.floor(n%60),2),i=m(Math.floor(n%1*100),3,!0);a.element.value=t+":"+r+":"+i});var f=function(e){var n=c[1].element.getBoundingClientRect(),t=n.width-30,r=n.left+15,i=Math.min(t,Math.max(e-r,0))/t,a=s.maxTime*i;return a=Math.round(20*a)/20},p=function(e,n,t){var r=A(l.keyframesList.map(function(e){return e.element}),t);-1!==r&&s.addKeyframe(r,f(n))};h.drag(e[0].element,{dragstart:function(e){e.inputEvent.stopPropagation()},drag:function(e){!function(e){u.setTime(f(e))}(e.clientX)},container:window}),c.forEach(function(e){var n=e.element;h.drag(n,{container:window,drag:function(e){var n=e.deltaX,t=e.deltaY,r=e.inputEvent;o[1].element.scrollLeft-=n,i.element.scrollTop-=t,r.preventDefault()},dragend:function(e){var n=e.isDrag,t=e.clientX,r=e.clientY,i=e.inputEvent;!n&&function(e,n,t){var r=b(e.target,function(e){return w(e,"keyframe")}),i=r?parseFloat(r.getAttribute("data-time")):f(n);u.setTime(i);var a=l.keyframesList,o=A(a.map(function(e){return e.element}),t);-1<o&&s.select(a[o].dataset.property,i),e.preventDefault()}(i,t,r),function(e,n,t,r,i){var a=d.now();e||(z===t&&C===r&&a-T<=500&&i(n,t,r),z=t,C=r,T=a)}(n,i,t,r,p)}})})},n.initDragValues=function(){var t,n=this,r=null;h.drag(this.ids.valuesArea.element,{container:window,dragstart:function(e){if(r=e.inputEvent.target,t=r.value,console.log(n.keycon.altKey,b(r,function(e){return"INPUT"===e.nodeName})),!n.keycon.altKey||!b(r,function(e){return"INPUT"===e.nodeName}))return!1},drag:function(n){var e=t.replace(/-?\d+/g,function(e){return""+(parseFloat(e)+Math.round(n.distX/2))});r.value=e},dragend:function(e){n.edit(r,r.value)}})},n.addKeyframe=function(e,n){var t=this.ids.keyframesList,r=this.scene,i=t[e].dataset.property,a=l(r,i),o=a.item,s=a.properties;this.editKeyframe(n,o.getNowValue(n,s),e),this.select(i,n)},n.removeKeyframe=function(e,n){if(e){var t=l(this.scene,e),r=t.item,i=t.properties;i.length?r.remove.apply(r,[n].concat(i)):r.removeFrame(n),this.update()}},n.update=function(){var e=this.scene,n=x(e),t=Math.ceil(e.getDuration()),r=t+5,i=this.axes.get(["zoom"]).zoom,a=this.maxTime;this.maxTime=r;var o=this.ids,s=o.keyframesAreas[0];i*=5<a?t/(a-5):1,this.axes.axm.set({zoom:i}),this.datadom.update(s,L(o,i,t,r));var l=D(o,n,this.axes.get(["zoom"]).zoom,t,this.maxTime);this.datadom.update(o.scrollArea,l),e.setTime(e.getTime())},n.editKeyframe=function(e,n,t){var r=this.ids,i=r.values;if(!("1"===r.properties[t].dataset.object)){var a=i[t].dataset.property.split("///"),o=this.scene;o.set.apply(o,[e].concat(a,[n])),o.setTime(e),this.update()}},n.restoreKeyframes=function(){this.scene.setTime(this.scene.getTime())},n.edit=function(e,n){var t=b(e,function(e){return w(e,"value")});if(t){var r=this.ids.values.map(function(e){return e.element}).indexOf(t);-1!==r&&this.editKeyframe(this.scene.getTime(),n,r)}},n.initEditor=function(){var t=this,e=this.ids.valuesArea.element;new r(e).keydown(function(e){!e.isToggle&&e.inputEvent.stopPropagation()}).keyup(function(e){!e.isToggle&&e.inputEvent.stopPropagation()}).keyup("enter",function(e){var n=e.inputEvent.target;t.edit(n,n.value)}).keyup("esc",function(e){e.inputEvent.target.blur()}),e.addEventListener("focusout",function(e){t.restoreKeyframes()})},e}()});
//# sourceMappingURL=timeline.min.js.map
