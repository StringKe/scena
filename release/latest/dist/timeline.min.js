/*
Copyright (c) 2019 
name: @scenejs/timeline
license: ISC
author: 
repository: git+https://github.com/daybrush/scenejs-timeline.git
version: 0.0.3
*/
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@daybrush/drag"),require("@daybrush/utils"),require("@egjs/axes")):"function"==typeof define&&define.amd?define(["@daybrush/drag","@daybrush/utils","@egjs/axes"],n):(e=e||self).Timeline=n(e.utils,e.utils,e.eg.Axes)}(this,function(t,z,o){"use strict";var c="scenejs_timeline_",p=c+"fold",j='\n.timeline {\n  position: relative;\n  font-size: 0;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n}\n.sticky_area, .scroll_area {\n   width: 100%;\n   position: relative;\n  display: flex;\n  -webkit-align-items: flex-start;\n  align-items: flex-start;\n}\n.sticky_area {\n  position: relative;\n  z-index: 10;\n  top: 0;\n  min-height: 30px;\n  height: 30px;\n}\n.sticky_area .keyframes {\n  padding: 0px;\n}\n.sticky_area .properties_area,\n.sticky_area .properties,\n.sticky_area .keyframes_area,\n.sticky_area .keyframes_scroll_area,\n.sticky_area .keyframes {\n  height: 100%;\n}\n.sticky_area .keyframes_area::-webkit-scrollbar {\n    display: none; // Safari and Chrome\n}\n.sticky_area .keyframe_cursor {\n    position: absolute;\n    border-top: 10px solid #f55;\n    border-left: 5px solid transparent;\n    border-right: 5px solid transparent;\n    width: 0;\n    height: 0;\n    bottom: 0;\n    top: auto;\n    background: none;\n    cursor: pointer;\n}\n.keytime {\n  position: relative;\n  display: inline-block;\n  height: 100%;\n  font-size: 13px;\n  font-weight: bold;\n  color: #777;\n}\n.keytime:last-child {\n  max-width: 0px;\n}\n.keytime span {\n  display: inline-block;\n  transform: translate(-50%);\n  color: #eee;\n}\n.keytime .graduation {\n  position: absolute;\n  bottom: 0;\n  width: 1px;\n  height: 10px;\n  background: #999;\n  transform: translate(-50%);\n}\n.keytime .graduation.half {\n  left: 50%;\n  height: 7px;\n}\n.keytime .graduation.quarter {\n  left: 25%;\n  height: 5px;\n}\n.keytime .graduation.quarter3 {\n  left: 75%;\n  height: 5px;\n}\n.scroll_area {\n  position: relative;\n  width: 100%;\n  height: calc(100% - 30px);\n  overflow: auto;\n}\n.properties_area, .keyframes_area {\n  display: inline-block;\n  position: relative;\n  font-size: 16px;\n  overflow: auto;\n}\n\n.properties_area::-webkit-scrollbar, .keyframes_area::-webkit-scrollbar {\n    display: none; // Safari and Chrome\n}\n.properties_area {\n  width: 30%;\n  max-width: 200px;\n  border-right: 1px solid #999;\n  box-sizing: border-box;\n}\n.properties_scroll_area {\n  display: inline-block;\n  min-width: 100%;\n}\n.keyframes_area {\n  flex: 1;\n}\n.keyframes_scroll_area {\n  position: relative;\n  min-width: 300px;\n}\n.keyframes, .properties {\n  position: relative;\n  height: 25px;\n  border-bottom: 1px solid #777;\n  box-sizing: border-box;\n  white-space: nowrap;\n  background: rgba(73, 73, 73, 0.7);\n  z-index: 1;\n}\n.properties:nth-child(2n), .keyframes:nth-child(2n) {\n  background: rgba(90, 90, 90, 0.7);\n}\n.properties {\n  line-height: 25px;\n  padding-left: 10px;\n  box-sizing: border-box;\n  font-size: 13px;\n  font-weight: bold;\n  color: #eee;\n}\n\n.properties .arrow {\n    position: relative;\n    display: inline-block;\n    margin-right: 5px;\n    width: 0;\n    vertical-align: middle;\n}\n.properties .arrow {\n    border-top: 6px solid #eee;\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n}\n.properties[data-fold="1"] .arrow {\n    border-top: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-right: 0;\n    border-left: 6px solid #eee;\n    margin-left: 2px;\n}\n.properties[data-object="0"] .arrow {\n    display: none;\n}\n.properties.fold, .keyframes.fold {\n    display: none;\n}\n.keyframes {\n\n}\n.keyframe_line {\n  position: absolute;\n  height: 8px;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  background: #aaa;\n  z-index: 0;\n}\n.keyframe {\n  position: absolute;\n  font-size: 0px;\n  width: 12px;\n  height: 12px;\n  top: 0px;\n  bottom: 0px;\n  margin: auto;\n  background: #fff;\n  border: 2px solid #333;\n  border-radius: 2px;\n  box-sizing: border-box;\n  transform: translate(-50%) rotate(45deg);\n  z-index: 1;\n  cursor: pointer;\n}\n.keyframes_container, .line_area {\n  position: relative;\n  width: calc(100% - 30px);\n  left: 15px;\n  height: 100%;\n}\n.line_area {\n  position: absolute;\n  top: 0;\n  z-index: 0;\n}\n.keyframe_cursor {\n  position: absolute;\n  top: 0;\n  z-index: 1;\n  background: #f55;\n  width: 1px;\n  height: 100%;\n  left: 15px;\n  transform: translate(-50%);\n}\n.division_line {\n  position: absolute;\n  background: #333;\n  width: 1px;\n  height: 100%;\n  transform: translate(-50%);\n}\n'.replace(/\.([^{,\s\d.]+)/g,"."+c+"$1");function L(e,n){var t=e.match(/\.([^.#\s])+/g)||[],r=(e.match(/^[^.#\s]+/g)||[])[0]||"div",a=(e.match(/#[^.#\s]+/g)||[])[0]||"",i=document.createElement(r);return a&&(i.id=a.replace(/^#/g,"")),i.className=t.map(function(e){return c+e.replace(/^\./g,"")}).join(" "),n&&n.appendChild(i),i}function S(n){return"object"==typeof n?Array.isArray(n)?"["+n.join(", ")+"]":"{"+function(e){var n=[];for(var t in e)n.push(t);return n}(n).map(function(e){return e+": "+S(n[e])}).join(", ")+"}":n}function f(e,n){for(var t=e;t&&t!==document.body;){if(n(t))return t;t=t.parentNode}return null}var C=!1;return function(){function e(e,n){e.finish(),this.scene=e,this.initElement(e,n)}var n=e.prototype;return n.getElement=function(){return this.timelineEl},n.initElement=function(e,n){var t=e.getDuration(),s=function(e){var l={};return e.forEach(function(n){var s=n.getDelay();n.times.forEach(function(o){var e=n.getFrame(o);!function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[e.length-1],a=e.slice(0,-1),i=a.join("///");i&&(l[i]||(l[i]=[]),l[i].push([s+o,r])),"object"==typeof r&&Object.keys(r).forEach(function(e){n.apply(void 0,a.concat([e,r[e]]))})}(n.getId(),e.get())})}),l}(e),r=L(".timeline");C||(L("style.timeline_style",r).innerHTML=j,C=!0);var a=L(".sticky_area",r),i=L(".properties_area",a),o=L(".keyframes_area",a),l=L(".properties",i),p=L(".keyframes_scroll_area",o),d=L(".keyframes_container",L(".keyframes",p)),c=L(".keyframe_cursor",p),f=L(".keyframe_cursor");l.innerHTML="Item Name";var u=L(".scroll_area",r),h=L(".properties_area",u),m=L(".properties_scroll_area",h),y=L(".keyframes_area",u),g=L(".keyframes_scroll_area",y),b=L(".line_area"),k=Math.ceil(t),x=k;p.style.minWidth=50*x+"px",g.style.minWidth=50*x+"px",p.style.width=100*(k?x/k:1)+"%",g.style.width=100*(k?x/k:1)+"%";for(var v=0;v<=x;++v){var _=v,E=L(".keytime",d);E.style.width=100/x+"%",L("span",E).innerHTML=_+"s",L(".graduation.start",E),L(".graduation.quarter",E),L(".graduation.half",E),L(".graduation.quarter3",E),L(".division_line",b).style.left=100/x*v+"%"}var w=function(e){var n=e.split("///"),t=n.length,p=s[e],r=L(".properties",m),a=L(".keyframes",g);L(".arrow.unfold",r);var i=L("span",r),d=L(".keyframes_container",a),o=n[t-1];i.innerHTML=o,r.style.paddingLeft=10+20*(t-1)+"px",r.setAttribute("data-id",o),r.setAttribute("data-parent",n[t-2]||""),r.setAttribute("data-property",e),r.setAttribute("data-object","0"),a.setAttribute("data-property",e),z.toArray(m.querySelectorAll('[data-property="'+n.slice(0,-1).join("///").replace(/"/g,'\\"')+'"]')).forEach(function(e){e.setAttribute("data-object","1")}),r.setAttribute("data-item",n[0]),p.forEach(function(e,n){var t=e[0],r=e[1],a=L(".keyframe",d),i=S(r);if(a.setAttribute("data-time",t),a.setAttribute("data-value",i),a.style.left=t/x*100+"%",a.innerHTML=t+" "+i,p[n+1]){var o=p[n+1],s=o[0];if(i===S(o[1])){var l=L(".keyframe_line",d);l.style.left=t/x*100+"%",l.style.width=(s-t)/x*100+"%"}}})};for(var A in s)w(A);g.appendChild(b),g.appendChild(f),this.timelineEl=r,this.cursorEl=f,this.cursorHeaderEl=c,this.keyframesScrollAreaEl=g,this.scrollAreaEl=u,this.propertiesAreaEl=h,this.keyframesHeaderScrollAreaEl=p,this.keyframesAreaEl=y,this.keyframesHeaderAreaEl=o,this.syncScroll(),this.wheelZoom(),this.drag(),this.fold(),n&&n.appendChild(r)},n.syncScroll=function(){var e=this.keyframesHeaderAreaEl,n=this.keyframesAreaEl,t=!1;e.addEventListener("scroll",function(){t?t=!1:(t=!0,n.scrollLeft=e.scrollLeft)}),n.addEventListener("scroll",function(){t?t=!1:(t=!0,e.scrollLeft=n.scrollLeft)})},n.wheelZoom=function(){var t=this.keyframesHeaderScrollAreaEl,r=this.keyframesScrollAreaEl,a=parseFloat(t.style.width),i=new o({zoom:{range:[100,1/0]}},{},{zoom:a});i.connect("zoom",new o.PinchInput(r,{scale:.7,hammerManagerOptions:{touchAction:"auto"}})),i.on("hold",function(e){console.log("hold"),e.inputEvent&&e.inputEvent.preventDefault()}),i.on("change",function(e){var n=e.pos.zoom;t.style.width=n+"%",r.style.width=n+"%",e.inputEvent&&e.inputEvent.preventDefault()}),t.addEventListener("wheel",function(e){var n=e.deltaY;i.setBy({zoom:n/a*5})})},n.fold=function(){var e=this.propertiesAreaEl,l=this.keyframesScrollAreaEl;e.addEventListener("click",function(e){var n=f(e.target,function(e){return z.hasClass(e,c+"properties")});if(n&&"0"!==n.getAttribute("data-object")){var s="1"===n.getAttribute("data-fold"),t=n.getAttribute("data-property"),r=function e(n,t){for(var r=[],a=n.nextElementSibling;a;){var i=a.getAttribute("data-property");if(0!==i.indexOf(t))break;if(r.push(a),"1"===a.getAttribute("data-object")){var o=e(a,i);r.push(o);for(var s=o;z.isArray(s);)s=o[o.length-1];a=s}a=a.nextElementSibling}return r}(n,t);n.setAttribute("data-fold",s?"":"1"),r.forEach(function e(n,t,r){if(z.isArray(n)){var a="1"===r[t-1].getAttribute("data-fold");(!s||s&&!a)&&n.forEach(e)}else{var i=n.getAttribute("data-property").replace(/"/g,'\\"'),o=l.querySelector("."+c+'keyframes[data-property="'+i+'"]');s?(z.removeClass(o,p),z.removeClass(n,p)):(z.addClass(o,p),z.addClass(n,p))}})}})},n.drag=function(){var e=this,i=e.cursorEl,o=e.cursorHeaderEl,a=e.scrollAreaEl,s=e.keyframesAreaEl,l=e.keyframesScrollAreaEl,n=e.keyframesHeaderScrollAreaEl,p=e.scene;function d(e){var n=l.getBoundingClientRect(),t=n.width-30,r=n.left+15,a=Math.min(t,Math.max(e-r,0))/t;p.setTime(100*a+"%")}p.on("animate",function(e){var n=e.time,t=Math.ceil(p.getDuration()),r=15-30*n/t,a=100*n/t;i.style.left="calc("+a+"% + "+r+"px)",o.style.left="calc("+a+"% + "+r+"px)"}),t.drag(o,{dragstart:function(e){e.inputEvent.stopPropagation()},drag:function(e){d(e.clientX)},container:window}),[l,n].forEach(function(e){t.drag(e,{container:window,drag:function(e){var n=e.deltaX,t=e.deltaY,r=e.inputEvent;s.scrollLeft-=n,a.scrollTop-=t,r.preventDefault()},dragend:function(e){var n=e.isDrag,t=e.clientX,r=e.inputEvent;!n&&function(e,n){var t=f(e.target,function(e){return z.hasClass(e,c+"keyframe")});t?p.setTime(t.getAttribute("data-time")):d(n),e.preventDefault()}(r,t)}})})},e}()});
//# sourceMappingURL=timeline.min.js.map
