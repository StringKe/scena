/*
Copyright (c) 2019 Daybrush
name: @scenejs/timeline
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/scenejs-timeline.git
version: 0.0.6
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Timeline=t()}(this,function(){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var h="scenejs_editor_",i="\n.item_info {\n    position: fixed;\n    right: 0;\n    top: 0;\n    width: 200px;\n    background: #000;\n}\n.options_area {\n\n}\n.option_area {\n    position: relative;\n    border-bottom: 1px solid #777;\n    box-sizing: border-box;\n    white-space: nowrap;\n    background: rgba(90, 90, 90, 0.7);\n    font-size: 13px;\n    font-weight: bold;\n    color: #eee;\n    display: flex;\n}\n.option_name, .option_value {\n    width: 50%;\n    height: 30px;\n    line-height: 20px;\n    box-sizing: border-box;\n    padding: 5px;\n}\n.option_name {\n    border-right: 1px solid #999;\n}\n.option_value input {\n    appearance: none;\n    -webkit-appearance: none;\n    outline: none;\n    position: relative;\n    display: block;\n    width: 100%;\n    height: 100%;\n    background: transparent;\n    color: #4af;\n    font-weight: bold;\n    background: none;\n    border: 0;\n    box-sizing: border-box;\n}\n".replace(/\.([^{,\s\d.]+)/g,"."+h+"$1"),u='\n.timeline {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  font-size: 0;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n}\n.header_area, .scroll_area {\n   width: 100%;\n   position: relative;\n  display: flex;\n  -webkit-align-items: flex-start;\n  align-items: flex-start;\n}\n.header_area {\n  position: relative;\n  z-index: 10;\n  top: 0;\n  height: 30px;\n  min-height: 30px;\n}\n.header_area .keyframes {\n  padding: 0px;\n}\n.header_area .properties_area,\n.header_area .keyframes_area,\n.header_area .values_area,\n.header_area .keyframes_scroll_area {\n    height: 100%;\n}\n.header_area .property, .header_area .value, .header_area .keyframes {\n  height: 100%;\n}\n.header_area .property {\n    line-height: 30px;\n}\n.value .add {\n    text-align: center;\n    color: #fff;\n    line-height: 30px;\n    font-weight: bold;\n    font-size: 20px;\n    cursor: pointer;\n}\n.header_area .keyframes_area::-webkit-scrollbar {\n    display: none; // Safari and Chrome\n}\n.header_area .keyframe_cursor {\n    position: absolute;\n    border-top: 10px solid #4af;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    width: 0;\n    height: 0;\n    bottom: 0;\n    top: auto;\n    background: none;\n    cursor: pointer;\n}\n.control_area .keyframes {\n    padding-left: 10px;\n}\n.play_control_area {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n.play_control_area .control {\n    position: relative;\n    display: inline-block;\n    vertical-align: middle;\n    color: white;\n    margin: 0px 15px;\n}\n.play {\n    border-left: 14px solid white;\n    border-top: 8px solid transparent;\n    border-bottom: 8px solid transparent;\n}\n.pause {\n    border-left: 4px solid #fff;\n    border-right: 4px solid #fff;\n    width: 6px;\n    height: 16px;\n}\n.prev {\n    border-right: 10px solid white;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n}\n.prev:before {\n    position: absolute;\n    content: "";\n    width: 3px;\n    height: 10px;\n    top: 0;\n    right: 100%;\n    transform: translate(0, -50%);\n    background: white;\n}\n.next {\n    border-left: 10px solid white;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n}\n.next:before {\n    position: absolute;\n    content: "";\n    width: 3px;\n    height: 10px;\n    top: 0;\n    transform: translate(0, -50%);\n    background: white;\n}\n.keytime {\n  position: relative;\n  display: inline-block;\n  height: 100%;\n  font-size: 13px;\n  font-weight: bold;\n  color: #777;\n}\n.keytime:last-child {\n  max-width: 0px;\n}\n.keytime span {\n  position: absolute;\n  line-height: 1;\n  bottom: 12px;\n  display: inline-block;\n  transform: translate(-50%);\n  color: #eee;\n}\n.keytime .graduation {\n  position: absolute;\n  bottom: 0;\n  width: 1px;\n  height: 10px;\n  background: #777;\n  transform: translate(-50%);\n}\n.keytime .graduation.half {\n  left: 50%;\n  height: 7px;\n}\n.keytime .graduation.quarter {\n  left: 25%;\n  height: 5px;\n}\n.keytime .graduation.quarter3 {\n  left: 75%;\n  height: 5px;\n}\n.scroll_area {\n  position: relative;\n  width: 100%;\n  height: calc(100% - 60px);\n  overflow: auto;\n}\n.properties_area, .keyframes_area, .values_area {\n  display: inline-block;\n  position: relative;\n  font-size: 16px;\n  overflow: auto;\n}\n\n.properties_area::-webkit-scrollbar, .keyframes_area::-webkit-scrollbar {\n    display: none; // Safari and Chrome\n}\n.properties_area {\n  width: 30%;\n  max-width: 200px;\n  box-sizing: border-box;\n}\n.values_area {\n    width: 50px;\n    min-width: 50px;\n    display: inline-block;\n    border-right: 1px solid #999;\n    box-sizing: border-box;\n}\n.value input {\n    appearance: none;\n    -webkit-appearance: none;\n    outline: none;\n    position: relative;\n    display: block;\n    width: 100%;\n    height: 100%;\n    background: transparent;\n    color: #4af;\n    font-weight: bold;\n    background: none;\n    border: 0;\n    box-sizing: border-box;\n    text-align: center;\n}\n.value {\n\n}\n.alt .value input {\n    cursor: ew-resize;\n}\n.value[data-object="1"] input {\n    display: none;\n}\n.properties_scroll_area {\n  display: inline-block;\n  min-width: 100%;\n}\n.keyframes_area {\n  flex: 1;\n}\n.keyframes_scroll_area {\n  position: relative;\n  min-width: 300px;\n}\n.keyframes, .property, .value {\n  position: relative;\n  height: 30px;\n  line-height: 30px;\n  border-bottom: 1px solid #777;\n  box-sizing: border-box;\n  white-space: nowrap;\n  background: rgba(90, 90, 90, 0.7);\n  z-index: 1;\n}\n\n.property {\n  padding-left: 10px;\n  box-sizing: border-box;\n  font-size: 13px;\n  font-weight: bold;\n  color: #eee;\n}\n.property .remove {\n    position: absolute;\n    display: inline-block;\n    cursor: pointer;\n    width: 18px;\n    height: 18px;\n    top: 0;\n    bottom: 0;\n    right: 10px;\n    margin: auto;\n    border-radius: 50%;\n    border: 2px solid #fff;\n    vertical-align: middle;\n    display: none;\n    margin-left: 10px;\n    box-sizing: border-box;\n}\n.property .remove:before, .property .remove:after {\n    position: absolute;\n    content: "";\n    width: 8px;\n    height: 2px;\n    border-radius: 1px;\n    background: #fff;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    margin: auto;\n}\n.property .remove:before {\n    transform: rotate(45deg);\n}\n.property .remove:after {\n    transform: rotate(-45deg);\n}\n.property:hover .remove {\n    display: inline-block;\n}\n\n[data-item="1"], [data-item="1"] .add {\n    height: 30px;\n    line-height: 30px;\n}\n.time_area {\n    font-size: 13px;\n    color: #4af;\n    line-height: 30px;\n    font-weight: bold;\n    height: 100%;\n    line-height: 30px;\n    border: 0;\n    background: transparent;\n    outline: 0;\n}\n.time_area:after {\n    content: "s";\n}\n.property .arrow {\n    position: relative;\n    display: inline-block;\n    margin-right: 5px;\n    width: 0;\n    vertical-align: middle;\n    cursor: pointer;\n    border-top: 6px solid #eee;\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n}\n.property[data-fold="1"] .arrow {\n    border-top: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-right: 0;\n    border-left: 6px solid #eee;\n    margin-left: 2px;\n}\n.property[data-object="0"] .arrow {\n    display: none;\n}\n.property.fold, .keyframes.fold, .value.fold {\n    display: none;\n}\n.property.select, .value.select, .keyframes.select {\n    background: rgba(120, 120, 120, 0.7);\n}\n.keyframes {\n\n}\n.keyframe_delay {\n  position: absolute;\n  height: 100%;\n  top: 0;\n  left: 0;\n  background: #4af;\n  opacity: 0.2;\n  z-index: 0;\n}\n.keyframe_line {\n  position: absolute;\n  height: 8px;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  background: #666;\n  z-index: 0;\n}\n.keyframe {\n  position: absolute;\n  font-size: 0px;\n  width: 12px;\n  height: 12px;\n  top: 0px;\n  bottom: 0px;\n  margin: auto;\n  background: #fff;\n  border: 2px solid #383838;\n  border-radius: 2px;\n  box-sizing: border-box;\n  transform: translate(-50%) rotate(45deg);\n  z-index: 1;\n  cursor: pointer;\n}\n.keyframe[data-no="1"] {\n    opacity: 0.2;\n}\n.select .keyframe {\n    border-color: #555;\n}\n.keyframe.select {\n    background: #4af;\n}\n.keyframes_container, .line_area {\n  position: relative;\n  width: calc(100% - 30px);\n  left: 15px;\n  height: 100%;\n}\n.line_area {\n  position: absolute;\n  top: 0;\n  z-index: 0;\n}\n.keyframe_cursor {\n  position: absolute;\n  top: 0;\n  z-index: 1;\n  background: #4af;\n  width: 1px;\n  height: 100%;\n  left: 15px;\n  transform: translate(-50%);\n}\n.division_line {\n  position: absolute;\n  background: #333;\n  width: 1px;\n  height: 100%;\n  transform: translate(-50%);\n}\n'.replace(/\.([^{,\s\d.]+)/g,"."+h+"$1"),_="direction",w="iterationCount",E="delay",T="playSpeed",P="alternate",A="reverse",I="alternate-reverse",t="object",n="undefined";function v(e){return typeof e===n}function p(e){return e&&typeof e===t}function a(e,t,n,i){e.addEventListener(t,n,i)}function d(e,t,n){var i=(""+e).length,r=[];n&&r.push(e);for(var o=i;o<t;++o)r.push(0);return n||r.push(e),r.join("")}function f(e,t){for(var n in t)e.style[n]=t[n]}function m(t,e){return e.findIndex(function(e){return e.dataset.key===t})}function c(e){var t=e.selector,n=e.dataset,i=e.attr,r=e.style,o=e.html,a=t.match(/\.([^.#\s])+/g)||[],s=(t.match(/^[^.#\s]+/g)||[])[0]||"div",u=(t.match(/#[^.#\s]+/g)||[])[0]||"",c=document.createElement(s);if(u&&(c.id=u.replace(/^#/g,"")),c.className=a.map(function(e){return""+h+e.replace(/^\./g,"")}).join(" "),n)for(var l in n)c.setAttribute("data-"+l,n[l]);if(i)for(var l in i)c.setAttribute(l,i[l]);return r&&f(c,r),o&&(c.innerHTML=o),c}function l(e,t){var n=t.dataset,i=t.attr,r=t.style,o=t.html,a=t.element;if(n)for(var s in n)a.setAttribute("data-"+s,n[s]);if(i)for(var s in i)a.setAttribute(s,i[s]);r&&f(a,r),e.html!==t.html&&(a.innerHTML=o)}function g(t){return"object"==typeof t?Array.isArray(t)?"["+t.join(", ")+"]":"{"+function(e){var t=[];for(var n in e)t.push(n);return t}(t).map(function(e){return e+": "+g(t[e])}).join(", ")+"}":t}function y(e,t){for(var n=e;n&&n!==document.body;){if(t(n))return n;n=n.parentNode}return null}function x(e,t){return function(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}(e,""+h+t)}function b(e,t){return function(e,t){e.classList?e.classList.add(t):e.className+=" "+t}(e,""+h+t)}function k(e,t){return function(e,t){if(e.classList)e.classList.remove(t);else{var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}}(e,""+h+t)}function C(e){return!!e.constructor.prototype.getItem}function D(e,t){for(var n=e.length,i=0;i<n;++i){var r=e[i].getBoundingClientRect(),o=r.top,a=o+r.height;if(o<=t&&t<a)return i}return-1}function O(e,t){var a=!1,s=0,u=0,c=0,l=0,h={},f=!1,n=t.container,i=void 0===n?e:n,r=t.dragstart,p=t.drag,o=t.dragend,d=t.events,m=void 0===d?["touch","mouse"]:d,v=-1<m.indexOf("touch");function g(e){return e.touches&&e.touches.length?e.touches[0]:e}function y(e){f=!(a=!0);var t=g(e),n=t.clientX,i=t.clientY;c=s=n,l=u=i,!(h={})===(r&&r({datas:h,inputEvent:e,clientX:n,clientY:i}))&&(a=!1),a&&e.preventDefault()}function x(e){if(a){var t=g(e),n=t.clientX,i=t.clientY,r=n-c,o=i-l;(r||o)&&(f=!0,p&&p({datas:h,clientX:n,clientY:i,deltaX:r,deltaY:o,distX:n-s,distY:i-u,inputEvent:e}),c=n,l=i)}}function b(e){a&&(a=!1,o&&o({datas:h,isDrag:f,inputEvent:e,clientX:c,clientY:l,distX:c-s,distY:l-u}))}-1<m.indexOf("mouse")&&(e.addEventListener("mousedown",y),i.addEventListener("mousemove",x),i.addEventListener("mouseup",b)),v&&(e.addEventListener("touchstart",y),i.addEventListener("touchmove",x),i.addEventListener("touchend",b))}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function s(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var S,M="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t}:Object.assign,L=["","webkit","Moz","MS","ms","o"],e="undefined"==typeof document?{style:{}}:document.createElement("div"),j="function",K=Math.round,R=Math.abs,F=Date.now;function N(e,t){for(var n,i,r=t[0].toUpperCase()+t.slice(1),o=0;o<L.length;){if((i=(n=L[o])?n+r:t)in e)return i;o++}}S="undefined"==typeof window?{}:window;var X=N(e.style,"touchAction"),Y=void 0!==X;var q="compute",H="manipulation",W="none",B="pan-x",U="pan-y",V=function(){if(!Y)return!1;var t={},n=S.CSS&&S.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(e){return t[e]=!n||S.CSS.supports("touch-action",e)}),t}(),Z="ontouchstart"in S,$=void 0!==N(S,"PointerEvent"),G=Z&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),Q="touch",J="mouse",ee=25,te=1,ne=4,ie=8,re=1,oe=2,ae=4,se=8,ue=16,ce=oe|ae,le=se|ue,he=ce|le,fe=["x","y"],pe=["clientX","clientY"];function de(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function me(e,t){return typeof e===j?e.apply(t&&t[0]||void 0,t):e}function ve(e,t){return-1<e.indexOf(t)}var ge=function(){function e(e,t){this.manager=e,this.set(t)}var t=e.prototype;return t.set=function(e){e===q&&(e=this.compute()),Y&&this.manager.element.style&&V[e]&&(this.manager.element.style[X]=e),this.actions=e.toLowerCase().trim()},t.update=function(){this.set(this.manager.options.touchAction)},t.compute=function(){var t=[];return de(this.manager.recognizers,function(e){me(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(e){if(ve(e,W))return W;var t=ve(e,B),n=ve(e,U);return t&&n?W:t||n?t?B:U:ve(e,H)?H:"auto"}(t.join(" "))},t.preventDefaults=function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,r=ve(i,W)&&!V[W],o=ve(i,U)&&!V[U],a=ve(i,B)&&!V[B];if(r){var s=1===e.pointers.length,u=e.distance<2,c=e.deltaTime<250;if(s&&u&&c)return}if(!a||!o)return r||o&&n&ce||a&&n&le?this.preventSrc(t):void 0}},t.preventSrc=function(e){this.manager.session.prevented=!0,e.preventDefault()},e}();function ye(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function xe(e){var t=e.length;if(1===t)return{x:K(e[0].clientX),y:K(e[0].clientY)};for(var n=0,i=0,r=0;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:K(n/t),y:K(i/t)}}function be(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:K(e.pointers[n].clientX),clientY:K(e.pointers[n].clientY)},n++;return{timeStamp:F(),pointers:t,center:xe(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ke(e,t,n){n||(n=fe);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(i*i+r*r)}function _e(e,t,n){n||(n=fe);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,i)/Math.PI}function we(e,t){return e===t?re:R(e)>=R(t)?e<0?oe:ae:t<0?se:ue}function Ee(e,t,n){return{x:t/e||0,y:n/e||0}}function Te(e,t){var n=e.session,i=t.pointers,r=i.length;n.firstInput||(n.firstInput=be(t)),1<r&&!n.firstMultiple?n.firstMultiple=be(t):1===r&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=t.center=xe(i);t.timeStamp=F(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=_e(s,u),t.distance=ke(s,u),function(e,t){var n=t.center,i=e.offsetDelta||{},r=e.prevDelta||{},o=e.prevInput||{};t.eventType!==te&&o.eventType!==ne||(r=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=r.x+(n.x-i.x),t.deltaY=r.y+(n.y-i.y)}(n,t),t.offsetDirection=we(t.deltaX,t.deltaY);var c=Ee(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=R(c.x)>R(c.y)?c.x:c.y,t.scale=a?function(e,t){return ke(t[0],t[1],pe)/ke(e[0],e[1],pe)}(a.pointers,i):1,t.rotation=a?function(e,t){return _e(t[1],t[0],pe)+_e(e[1],e[0],pe)}(a.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,i,r,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(t.eventType!==ie&&(ee<s||void 0===a.velocity)){var u=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,l=Ee(s,u,c);i=l.x,r=l.y,n=R(l.x)>R(l.y)?l.x:l.y,o=we(u,c),e.lastInterval=t}else n=a.velocity,i=a.velocityX,r=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=i,t.velocityY=r,t.direction=o}(n,t);var l=e.element;ye(t.srcEvent.target,l)&&(l=t.srcEvent.target),t.target=l}function Pe(e,t,n){var i=n.pointers.length,r=n.changedPointers.length,o=t&te&&i-r==0,a=t&(ne|ie)&&i-r==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,Te(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function Ae(e){return e.trim().split(/\s+/g)}function Ie(t,e,n){de(Ae(e),function(e){t.addEventListener(e,n,!1)})}function Ce(t,e,n){de(Ae(e),function(e){t.removeEventListener(e,n,!1)})}function De(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||window}var Oe=function(){function e(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){me(t.options.enable,[t])&&n.handler(e)},this.init()}var t=e.prototype;return t.handler=function(){},t.init=function(){this.evEl&&Ie(this.element,this.evEl,this.domHandler),this.evTarget&&Ie(this.target,this.evTarget,this.domHandler),this.evWin&&Ie(De(this.element),this.evWin,this.domHandler)},t.destroy=function(){this.evEl&&Ce(this.element,this.evEl,this.domHandler),this.evTarget&&Ce(this.target,this.evTarget,this.domHandler),this.evWin&&Ce(De(this.element),this.evWin,this.domHandler)},e}();function ze(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}var Se={pointerdown:te,pointermove:2,pointerup:ne,pointercancel:ie,pointerout:ie},Me={2:Q,3:"pen",4:J,5:"kinect"},Le="pointerdown",je="pointermove pointerup pointercancel";S.MSPointerEvent&&!S.PointerEvent&&(Le="MSPointerDown",je="MSPointerMove MSPointerUp MSPointerCancel");var Ke=function(n){function i(){var e,t=i.prototype;return t.evEl=Le,t.evWin=je,(e=n.apply(this,arguments)||this).store=e.manager.session.pointerEvents=[],e}return s(i,n),i.prototype.handler=function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),r=Se[i],o=Me[e.pointerType]||e.pointerType,a=o===Q,s=ze(t,e.pointerId,"pointerId");r&te&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):r&(ne|ie)&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))},i}(Oe);function Re(e){return Array.prototype.slice.call(e,0)}var Fe={touchstart:te,touchmove:2,touchend:ne,touchcancel:ie},Ne=function(t){function n(){var e;return n.prototype.evTarget="touchstart touchmove touchend touchcancel",(e=t.apply(this,arguments)||this).targetIds={},e}return s(n,t),n.prototype.handler=function(e){var t=Fe[e.type],n=function(e,t){var n,i,r=Re(e.touches),o=this.targetIds;if(t&(2|te)&&1===r.length)return o[r[0].identifier]=!0,[r,r];var a=Re(e.changedTouches),s=[],u=this.target;if(i=r.filter(function(e){return ye(e.target,u)}),t===te)for(n=0;n<i.length;)o[i[n].identifier]=!0,n++;n=0;for(;n<a.length;)o[a[n].identifier]&&s.push(a[n]),t&(ne|ie)&&delete o[a[n].identifier],n++;return s.length?[function(e,n,t){for(var i=[],r=[],o=0;o<e.length;){var a=n?e[o][n]:e[o];ze(r,a)<0&&i.push(e[o]),r[o]=a,o++}return t&&(i=n?i.sort(function(e,t){return e[n]>t[n]}):i.sort()),i}(i.concat(s),"identifier",!0),s]:void 0}.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:Q,srcEvent:e})},n}(Oe);var Xe={mousedown:te,mousemove:2,mouseup:ne},Ye=function(n){function i(){var e,t=i.prototype;return t.evEl="mousedown",t.evWin="mousemove mouseup",(e=n.apply(this,arguments)||this).pressed=!1,e}return s(i,n),i.prototype.handler=function(e){var t=Xe[e.type];t&te&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=ne),this.pressed&&(t&ne&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:J,srcEvent:e}))},i}(Oe),qe=2500,He=25;function We(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY},i=this.lastTouches;this.lastTouches.push(n);setTimeout(function(){var e=i.indexOf(n);-1<e&&i.splice(e,1)},qe)}}var Be=function(){return function(n){function e(e,t){var o;return(o=n.call(this,e,t)||this).handler=function(e,t,n){var i=n.pointerType===Q,r=n.pointerType===J;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)(function(e,t){e&te?(this.primaryTouch=t.changedPointers[0].identifier,We.call(this,t)):e&(ne|ie)&&We.call(this,t)}).call(z(z(o)),t,n);else if(r&&function(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(t-r.x),a=Math.abs(n-r.y);if(o<=He&&a<=He)return!0}return!1}.call(z(z(o)),n))return;o.callback(e,t,n)}},o.touch=new Ne(o.manager,o.handler),o.mouse=new Ye(o.manager,o.handler),o.primaryTouch=null,o.lastTouches=[],o}return s(e,n),e.prototype.destroy=function(){this.touch.destroy(),this.mouse.destroy()},e}(Oe)}();function Ue(e,t,n){return!!Array.isArray(e)&&(de(e,n[t],n),!0)}var Ve=1;function Ze(e,t){var n=t.manager;return n?n.get(e):e}function $e(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}var Ge=function(){function e(e){void 0===e&&(e={}),this.options=o({enable:!0},e),this.id=Ve++,this.manager=null,this.state=1,this.simultaneous={},this.requireFail=[]}var t=e.prototype;return t.set=function(e){return M(this.options,e),this.manager&&this.manager.touchAction.update(),this},t.recognizeWith=function(e){if(Ue(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Ze(e,this)).id]||(t[e.id]=e).recognizeWith(this),this},t.dropRecognizeWith=function(e){return Ue(e,"dropRecognizeWith",this)||(e=Ze(e,this),delete this.simultaneous[e.id]),this},t.requireFailure=function(e){if(Ue(e,"requireFailure",this))return this;var t=this.requireFail;return-1===ze(t,e=Ze(e,this))&&(t.push(e),e.requireFailure(this)),this},t.dropRequireFailure=function(e){if(Ue(e,"dropRequireFailure",this))return this;e=Ze(e,this);var t=ze(this.requireFail,e);return-1<t&&this.requireFail.splice(t,1),this},t.hasRequireFailures=function(){return 0<this.requireFail.length},t.canRecognizeWith=function(e){return!!this.simultaneous[e.id]},t.emit=function(t){var n=this,e=this.state;function i(e){n.manager.emit(e,t)}e<8&&i(n.options.event+$e(e)),i(n.options.event),t.additionalEvent&&i(t.additionalEvent),8<=e&&i(n.options.event+$e(e))},t.tryEmit=function(e){if(this.canEmit())return this.emit(e);this.state=32},t.canEmit=function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},t.recognize=function(e){var t=M({},e);if(!me(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},t.process=function(e){},t.getTouchAction=function(){},t.reset=function(){},e}(),Qe={domEvents:!1,touchAction:q,enable:!0,inputTarget:null,inputClass:null,preset:[],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Je(n,i){var r,o=n.element;o.style&&(de(n.options.cssProps,function(e,t){r=N(o.style,t),i?(n.oldCssProps[r]=o.style[r],o.style[r]=e):o.style[r]=n.oldCssProps[r]||""}),i||(n.oldCssProps={}))}var et=function(){function e(e,t){var n=this;this.options=M({},Qe,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||($?Ke:G?Ne:Z?Be:Ye))(e,Pe)}(this),this.touchAction=new ge(this,this.options.touchAction),Je(this,!0),de(this.options.recognizers,function(e){var t=n.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}var t=e.prototype;return t.set=function(e){return M(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},t.stop=function(e){this.session.stopped=e?2:1},t.recognize=function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var i=this.recognizers,r=t.curRecognizer;(!r||r&&8&r.state)&&(r=t.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===t.stopped||r&&n!==r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&14&n.state&&(r=t.curRecognizer=n),o++}},t.get=function(e){if(e instanceof Ge)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null},t.add=function(e){if(Ue(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),(e.manager=this).touchAction.update(),e},t.remove=function(e){if(Ue(e,"remove",this))return this;var t=this.get(e);if(e){var n=this.recognizers,i=ze(n,t);-1!==i&&(n.splice(i,1),this.touchAction.update())}return this},t.on=function(e,t){if(void 0===e||void 0===t)return this;var n=this.handlers;return de(Ae(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this},t.off=function(e,t){if(void 0===e)return this;var n=this.handlers;return de(Ae(e),function(e){t?n[e]&&n[e].splice(ze(n[e],t),1):delete n[e]}),this},t.emit=function(e,t){this.options.domEvents&&function(e,t){var n=document.createEvent("Event");n.initEvent(e,!0,!0),(n.gesture=t).target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},t.destroy=function(){this.element&&Je(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null},e}(),tt=function(n){function e(e){return void 0===e&&(e={}),n.call(this,o({event:"pinch",threshold:0,pointers:2},e))||this}s(e,n);var t=e.prototype;return t.getTouchAction=function(){return[W]},t.attrTest=function(e){return n.prototype.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},t.emit=function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}n.prototype.emit.call(this,e)},e}(function(t){function e(e){return void 0===e&&(e={}),t.call(this,o({pointers:1},e))||this}s(e,t);var n=e.prototype;return n.attrTest=function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},n.process=function(e){var t=this.state,n=e.eventType,i=6&t,r=this.attrTest(e);return i&&(n&ie||!r)?16|t:i||r?n&ne?8|t:2&t?4|t:2:32},e}(Ge));function nt(e){return void 0===e}var it=function(){var e=function(){function e(){this._eventHandler={},this.options={}}var t=e.prototype;return t.trigger=function(e,t){void 0===t&&(t={});var n=this._eventHandler[e]||[];if(!(0<n.length))return!0;n=n.concat(),t.eventType=e;var i=!1,r=[t],o=0;t.stop=function(){i=!0},t.currentTarget=this;for(var a=arguments.length,s=new Array(2<a?a-2:0),u=2;u<a;u++)s[u-2]=arguments[u];for(1<=s.length&&(r=r.concat(s)),o=0;n[o];o++)n[o].apply(this,r);return!i},t.once=function(r,o){if("object"==typeof r&&nt(o)){var e,t=r;for(e in t)this.once(e,t[e]);return this}if("string"==typeof r&&"function"==typeof o){var a=this;this.on(r,function e(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];o.apply(a,n),a.off(r,e)})}return this},t.hasOn=function(e){return!!this._eventHandler[e]},t.on=function(e,t){if("object"==typeof e&&nt(t)){var n,i=e;for(n in i)this.on(n,i[n]);return this}if("string"==typeof e&&"function"==typeof t){var r=this._eventHandler[e];nt(r)&&(this._eventHandler[e]=[],r=this._eventHandler[e]),r.push(t)}return this},t.off=function(e,t){if(nt(e))return this._eventHandler={},this;if(nt(t)){if("string"==typeof e)return this._eventHandler[e]=void 0,this;var n,i=e;for(n in i)this.off(n,i[n]);return this}var r,o,a=this._eventHandler[e];if(a)for(r=0;void 0!==(o=a[r]);r++)if(o===t){a=a.splice(r,1);break}return this},e}();return e.VERSION="2.1.2",e}(),rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};var ot,at=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};ot="undefined"==typeof window?{}:window;var st=1e5,ut=function(){if("undefined"==typeof document)return"";for(var e=(document.head||document.getElementsByTagName("head")[0]).style,t=["transform","webkitTransform","msTransform","mozTransform"],n=0,i=t.length;n<i;n++)if(t[n]in e)return t[n];return""}();function ct(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);return t}var lt=ot.requestAnimationFrame||ot.webkitRequestAnimationFrame,ht=ot.cancelAnimationFrame||ot.webkitCancelAnimationFrame;if(lt&&!ht){var ft={},pt=lt;lt=function(t){var n=pt(function(e){ft[n]&&t(e)});return ft[n]=!0,n},ht=function(e){delete ft[e]}}else lt&&ht||(lt=function(e){return ot.setTimeout(function(){e(ot.performance&&ot.performance.now&&ot.performance.now()||(new Date).getTime())},16)},ht=ot.clearTimeout);function dt(e,t){var n={};for(var i in e)i&&(n[i]=t(e[i],i));return n}function mt(e,t){var n={};for(var i in e)i&&t(e[i],i)&&(n[i]=e[i]);return n}function vt(e,t){for(var n in e)if(n&&!t(e[n],n))return!1;return!0}function gt(e,n){return vt(e,function(e,t){return e===n[t]})}function yt(e){return Math.round(e*st)/st}function xt(e,t,n,i){var r=e,o=[n[0]?t[0]:i?t[0]-i[0]:t[0],n[1]?t[1]:i?t[1]+i[1]:t[1]];return r=Math.max(o[0],r),+yt(r=Math.min(o[1],r))}function bt(e,t){return e<t[0]||e>t[1]}function kt(e,t,n){return n[1]&&e>t[1]||n[0]&&e<t[0]}function _t(e,t,n,i){var r=e,o=t[0],a=t[1],s=a-o;return n[1]&&a<e&&(r=(r-a)%s+o),n[0]&&e<o&&(r=(r-o)%s+a),i?r:+yt(r)}function wt(e,t,n){return Math.max(Math.min(e,n),t)}var Et=function(){function e(e){var t=e.options,n=e.itm,i=e.em,r=e.axm;this.options=t,this.itm=n,this.em=i,this.axm=r,this.animationEnd=this.animationEnd.bind(this)}var t=e.prototype;return t.getDuration=function(n,e,t){var i,r=this;if(void 0!==t)i=t;else{var o=dt(e,function(e,t){return function(e,t){var n=Math.sqrt(e/t*2);return n<100?0:n}(Math.abs(Math.abs(e)-Math.abs(n[t])),r.options.deceleration)});i=Object.keys(o).reduce(function(e,t){return Math.max(e,o[t])},-1/0)}return wt(i,this.options.minimumDuration,this.options.maximumDuration)},t.createAnimationParam=function(e,t,n){var i=this.axm.get(),r=e,o=n&&n.event||null;return{depaPos:i,destPos:r,duration:wt(t,this.options.minimumDuration,this.options.maximumDuration),delta:this.axm.getDelta(i,r),inputEvent:o,input:n&&n.input||null,isTrusted:!!o,done:this.animationEnd}},t.grab=function(e,t){if(this._animateParam&&e.length){var n=this.axm.get(e),i=this.axm.map(n,function(e,t){return _t(e,t.range,t.circular,!1)});vt(i,function(e,t){return n[t]===e})||this.em.triggerChange(i,!1,n,t,!!t),this._animateParam=null,this._raf&&function(e){ht(e)}(this._raf),this._raf=null,this.em.triggerAnimationEnd(!(!t||!t.event))}},t.getEventInfo=function(){return this._animateParam&&this._animateParam.input&&this._animateParam.inputEvent?{input:this._animateParam.input,event:this._animateParam.inputEvent}:null},t.restore=function(e){var t=this.axm.get(),n=this.axm.map(t,function(e,t){return Math.min(t.range[1],Math.max(t.range[0],e))});this.animateTo(n,this.getDuration(t,n),e)},t.animationEnd=function(){var e=this.getEventInfo();this._animateParam=null;var t=this.axm.filter(this.axm.get(),function(e,t){return kt(e,t.range,t.circular)});0<Object.keys(t).length&&this.setTo(this.axm.map(t,function(e,t){return _t(e,t.range,t.circular,!1)})),this.itm.setInterrupt(!1),this.em.triggerAnimationEnd(!!e),this.axm.isOutside()?this.restore(e):this.finish(!!e)},t.finish=function(e){this._animateParam=null,this.itm.setInterrupt(!1),this.em.triggerFinish(e)},t.animateLoop=function(o,a){if(o.duration){this._animateParam=at({},o);var s=this._animateParam,u=this,c=s.depaPos;s.startTime=(new Date).getTime(),function e(){u._raf=null;var n=u.easing(((new Date).getTime()-s.startTime)/o.duration),t=dt(s.depaPos,function(e,t){return e+s.delta[t]*n}),i=!u.em.triggerChange(t,!1,c);if(c=dt(t,function(e){return yt(e)}),1<=n){var r=o.destPos;return gt(r,u.axm.get(Object.keys(r)))||u.em.triggerChange(r,!0,c),void a()}i?u.finish(!1):u._raf=function(e){return lt(e)}(e)}()}else this.em.triggerChange(o.destPos,!0),a()},t.getUserControll=function(e){var t=e.setTo();return t.destPos=this.axm.get(t.destPos),t.duration=wt(t.duration,this.options.minimumDuration,this.options.maximumDuration),t},t.animateTo=function(e,t,n){var i=this,r=this.createAnimationParam(e,t,n),o=at({},r.depaPos),a=this.em.triggerAnimationStart(r),s=this.getUserControll(r);if(!a&&this.axm.every(s.destPos,function(e,t){return kt(e,t.range,t.circular)})&&console.warn("You can't stop the 'animation' event when 'circular' is true."),a&&!gt(s.destPos,o)){var u=n&&n.event||null;this.animateLoop({depaPos:o,destPos:s.destPos,duration:s.duration,delta:this.axm.getDelta(o,s.destPos),isTrusted:!!u,inputEvent:u,input:n&&n.input||null},function(){return i.animationEnd()})}},t.easing=function(e){return 1<e?1:this.options.easing(e)},t.setTo=function(e,t){void 0===t&&(t=0);var n=Object.keys(e);this.grab(n);var i=this.axm.get(n);if(gt(e,i))return this;this.itm.setInterrupt(!0);var r=mt(e,function(e,t){return i[t]!==e});return Object.keys(r).length&&(gt(r=this.axm.map(r,function(e,t){var n=t.range,i=t.circular;return i&&(i[0]||i[1])?e:xt(e,n,i)}),i)||(0<t?this.animateTo(r,t):(this.em.triggerChange(r),this.finish(!1)))),this},t.setBy=function(n,e){return void 0===e&&(e=0),this.setTo(dt(this.axm.get(Object.keys(n)),function(e,t){return e+n[t]}),e)},e}(),Tt=function(){function e(e){this.axes=e}var t=e.prototype;return t.triggerHold=function(e,t){this.axes.trigger("hold",{pos:e,input:t.input||null,inputEvent:t.event||null,isTrusted:!0})},t.triggerRelease=function(e){e.setTo=this.createUserControll(e.destPos,e.duration),this.axes.trigger("release",e)},t.triggerChange=function(e,t,n,i,r){void 0===r&&(r=!1);var o=this.am,a=o.axm,s=o.getEventInfo(),u=a.moveTo(e,t,n),c=i&&i.event||s&&s.event||null,l={pos:u.pos,delta:u.delta,holding:r,inputEvent:c,isTrusted:!!c,input:i&&i.input||s&&s.input||null,set:c?this.createUserControll(u.pos):function(){}},h=this.axes.trigger("change",l);return c&&a.set(l.set().destPos),h},t.triggerAnimationStart=function(e){return e.setTo=this.createUserControll(e.destPos,e.duration),this.axes.trigger("animationStart",e)},t.triggerAnimationEnd=function(e){void 0===e&&(e=!1),this.axes.trigger("animationEnd",{isTrusted:e})},t.triggerFinish=function(e){void 0===e&&(e=!1),this.axes.trigger("finish",{isTrusted:e})},t.createUserControll=function(e,t){void 0===t&&(t=0);var n={destPos:at({},e),duration:t};return function(e,t){return e&&(n.destPos=at({},e)),void 0!==t&&(n.duration=t),n}},t.setAnimationManager=function(e){this.am=e},t.destroy=function(){this.axes.off()},e}(),Pt=function(){function e(e){this.options=e,this._prevented=!1}var t=e.prototype;return t.isInterrupting=function(){return this.options.interruptable||this._prevented},t.isInterrupted=function(){return!this.options.interruptable&&this._prevented},t.setInterrupt=function(e){!this.options.interruptable&&(this._prevented=e)},e}(),At=function(){function e(e,t){var n=this;this.axis=e,this.options=t,this._complementOptions(),this._pos=Object.keys(this.axis).reduce(function(e,t){return e[t]=n.axis[t].range[0],e},{})}var t=e.prototype;return t._complementOptions=function(){var r=this;Object.keys(this.axis).forEach(function(i){r.axis[i]=at({range:[0,100],bounce:[0,0],circular:[!1,!1]},r.axis[i]),["bounce","circular"].forEach(function(e){var t=r.axis,n=t[i][e];/string|number|boolean/.test(typeof n)&&(t[i][e]=[n,n])})})},t.getDelta=function(e,t){var n=this.get(e);return dt(this.get(t),function(e,t){return e-n[t]})},t.get=function(e){var n=this;return e&&Array.isArray(e)?e.reduce(function(e,t){return t&&t in n._pos&&(e[t]=n._pos[t]),e},{}):at({},this._pos,e||{})},t.moveTo=function(n,i,r){void 0===r&&(r=this._pos);var e=dt(this._pos,function(e,t){return t in n&&t in r?n[t]-r[t]:0});return this.set(this.map(n,function(e,t){return t?_t(e,t.range,t.circular,i):0})),{pos:at({},this._pos),delta:e}},t.set=function(e){for(var t in e)t&&t in this._pos&&(this._pos[t]=e[t])},t.every=function(e,n){var i=this.axis;return vt(e,function(e,t){return n(e,i[t],t)})},t.filter=function(e,n){var i=this.axis;return mt(e,function(e,t){return n(e,i[t],t)})},t.map=function(e,n){var i=this.axis;return dt(e,function(e,t){return n(e,i[t],t)})},t.isOutside=function(e){return!this.every(e?this.get(e):this._pos,function(e,t){return!bt(e,t.range)})},e}(),It=function(){function e(e){var t=e.options,n=e.itm,i=e.em,r=e.axm,o=e.am;this.isOutside=!1,this.moveDistance=null,this.isStopped=!1,this.options=t,this.itm=n,this.em=i,this.axm=r,this.am=o}var t=e.prototype;return t.atOutside=function(e){var a=this;if(this.isOutside)return this.axm.map(e,function(e,t){var n=t.range[0]-t.bounce[0],i=t.range[1]+t.bounce[1];return i<e?i:e<n?n:e});var s=this.am.easing(1e-5)/1e-5;return this.axm.map(e,function(e,t){var n=t.range[0],i=t.range[1],r=t.bounce,o=t.circular;return o&&(o[0]||o[1])?e:e<n?n-a.am.easing((n-e)/(r[0]*s))*r[0]:i<e?i+a.am.easing((e-i)/(r[1]*s))*r[1]:e})},t.get=function(e){return this.axm.get(e.axes)},t.hold=function(e,t){if(!this.itm.isInterrupted()&&e.axes.length){var n={input:e,event:t};this.isStopped=!1,this.itm.setInterrupt(!0),this.am.grab(e.axes,n),!this.moveDistance&&this.em.triggerHold(this.axm.get(),n),this.isOutside=this.axm.isOutside(e.axes),this.moveDistance=this.axm.get(e.axes)}},t.change=function(e,t,n){if(!this.isStopped&&this.itm.isInterrupting()&&!this.axm.every(n,function(e){return 0===e})){var i,r=this.moveDistance||this.axm.get(e.axes);i=dt(r,function(e,t){return e+(n[t]||0)}),this.moveDistance&&(this.moveDistance=i),this.isOutside&&this.axm.every(r,function(e,t){return!bt(e,t.range)})&&(this.isOutside=!1),i=this.atOutside(i),!this.em.triggerChange(i,!1,r,{input:e,event:t},!0)&&(this.isStopped=!0,this.moveDistance=null,this.am.finish(!1))}},t.release=function(e,t,n,i){if(!this.isStopped&&this.itm.isInterrupting()&&this.moveDistance){var r=this.axm.get(e.axes),o=this.axm.get(),a=this.axm.get(this.axm.map(n,function(e,t,n){return t.circular&&(t.circular[0]||t.circular[1])?r[n]+e:xt(r[n]+e,t.range,t.circular,t.bounce)})),s=this.am.getDuration(a,r,i);0===s&&(a=at({},o));var u={depaPos:o,destPos:a,duration:s,delta:this.axm.getDelta(o,a),inputEvent:t,input:e,isTrusted:!0};this.em.triggerRelease(u),this.moveDistance=null;var c=this.am.getUserControll(u),l=gt(c.destPos,o),h={input:e,event:t};l||0===c.duration?(!l&&this.em.triggerChange(c.destPos,!1,o,h,!0),this.itm.setInterrupt(!1),this.axm.isOutside()?this.am.restore(h):this.em.triggerFinish(!0)):this.am.animateTo(c.destPos,c.duration,h)}},e}(),Ct=function(r){function e(e,t,n){void 0===e&&(e={});var i=r.call(this)||this;return i.axis=e,i._inputs=[],i.options=at({easing:function(e){return 1-Math.pow(1-e,3)},interruptable:!0,maximumDuration:1/0,minimumDuration:0,deceleration:6e-4},t),i.itm=new Pt(i.options),i.axm=new At(i.axis,i.options),i.em=new Tt(i),i.am=new Et(i),i.io=new It(i),i.em.setAnimationManager(i.am),n&&i.em.triggerChange(n),i}!function(e,t){function n(){this.constructor=e}rt(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,r);var t=e.prototype;return t.connect=function(e,t){var n;if(n="string"==typeof e?e.split(" "):e.concat(),~this._inputs.indexOf(t)&&this.disconnect(t),"hammer"in t){var i=this._inputs.filter(function(e){return e.hammer&&e.element===t.element});i.length&&(t.hammer=i[0].hammer)}return t.mapAxes(n),t.connect(this.io),this._inputs.push(t),this},t.disconnect=function(e){if(e){var t=this._inputs.indexOf(e);0<=t&&(this._inputs[t].disconnect(),this._inputs.splice(t,1))}else this._inputs.forEach(function(e){return e.disconnect()}),this._inputs=[];return this},t.get=function(e){return this.axm.get(e)},t.setTo=function(e,t){return void 0===t&&(t=0),this.am.setTo(e,t),this},t.setBy=function(e,t){return void 0===t&&(t=0),this.am.setBy(e,t),this},t.isBounceArea=function(e){return this.axm.isOutside(e)},t.destroy=function(){this.disconnect(),this.em.destroy()},e.VERSION="2.5.10",e.TRANSFORM=ut,e.DIRECTION_NONE=re,e.DIRECTION_LEFT=oe,e.DIRECTION_RIGHT=ae,e.DIRECTION_UP=se,e.DIRECTION_DOWN=ue,e.DIRECTION_HORIZONTAL=ce,e.DIRECTION_VERTICAL=le,e.DIRECTION_ALL=he,e}(it),Dt="PointerEvent"in ot||"MSPointerEvent"in ot,Ot="ontouchstart"in ot,zt="_EGJS_AXES_INPUTTYPE_";function St(i,e){return e.reduce(function(e,t,n){return i[n]&&(e[i[n]]=t),e},{})}var Mt=function(){function e(e,t){if(this.axes=[],this.hammer=null,this.element=null,this._base=null,this._prev=null,this.pinchRecognizer=null,void 0===et)throw new Error("The Hammerjs must be loaded before eg.Axes.PinchInput.\nhttp://hammerjs.github.io/");this.element=function t(e,n){var i;if(void 0===n&&(n=!1),"string"==typeof e){if(e.match(/^<([a-z]+)\s*([^>]*)>/)){var r=document.createElement("div");r.innerHTML=e,i=ct(r.childNodes)}else i=ct(document.querySelectorAll(e));n||(i=1<=i.length?i[0]:void 0)}else e===ot?i=e:!e.nodeName||1!==e.nodeType&&9!==e.nodeType?"jQuery"in ot&&e instanceof jQuery||e.constructor.prototype.jquery?i=n?e.toArray():e.get(0):Array.isArray(e)&&(i=e.map(function(e){return t(e)}),n||(i=1<=i.length?i[0]:void 0)):i=e;return i}(e),this.options=at({scale:1,threshold:0,inputType:["touch","pointer"],hammerManagerOptions:{cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",userDrag:"none"}}},t),this.onPinchStart=this.onPinchStart.bind(this),this.onPinchMove=this.onPinchMove.bind(this),this.onPinchEnd=this.onPinchEnd.bind(this)}var t=e.prototype;return t.mapAxes=function(e){this.axes=e},t.connect=function(e){var t={threshold:this.options.threshold};if(this.hammer)this.removeRecognizer(),this.dettachEvent();else{var n=this.element[zt];n||(n=String(Math.round(Math.random()*(new Date).getTime())));var i=function(e){void 0===e&&(e=[]);var t=!1,n=!1,i=!1;return e.forEach(function(e){switch(e){case"mouse":n=!0;break;case"touch":t=Ot;break;case"pointer":i=Dt}}),i?Ke:t&&n?Be:t?Ne:n?Ye:null}(this.options.inputType);if(!i)throw new Error("Wrong inputType parameter!");this.hammer=function(e,t){try{return new et(e,at({},t))}catch(e){return null}}(this.element,at({inputClass:i},this.options.hammerManagerOptions)),this.element[zt]=n}return this.pinchRecognizer=new tt(t),this.hammer.add(this.pinchRecognizer),this.attachEvent(e),this},t.disconnect=function(){return this.removeRecognizer(),this.hammer&&(this.hammer.remove(this.pinchRecognizer),this.pinchRecognizer=null,this.dettachEvent()),this},t.destroy=function(){this.disconnect(),this.hammer&&0===this.hammer.recognizers.length&&this.hammer.destroy(),delete this.element[zt],this.element=null,this.hammer=null},t.removeRecognizer=function(){this.hammer&&this.pinchRecognizer&&(this.hammer.remove(this.pinchRecognizer),this.pinchRecognizer=null)},t.onPinchStart=function(e){this._base=this.observer.get(this)[this.axes[0]];var t=this.getOffset(e.scale);this.observer.hold(this,e),this.observer.change(this,e,St(this.axes,[t])),this._prev=e.scale},t.onPinchMove=function(e){var t=this.getOffset(e.scale,this._prev);this.observer.change(this,e,St(this.axes,[t])),this._prev=e.scale},t.onPinchEnd=function(e){var t=this.getOffset(e.scale,this._prev);this.observer.change(this,e,St(this.axes,[t])),this.observer.release(this,e,St(this.axes,[0]),0),this._base=null,this._prev=null},t.getOffset=function(e,t){return void 0===t&&(t=1),this._base*(e-t)*this.options.scale},t.attachEvent=function(e){this.observer=e,this.hammer.on("pinchstart",this.onPinchStart).on("pinchmove",this.onPinchMove).on("pinchend",this.onPinchEnd)},t.dettachEvent=function(){this.hammer.off("pinchstart",this.onPinchStart).off("pinchmove",this.onPinchMove).off("pinchend",this.onPinchEnd),this.observer=null,this._prev=null},t.enable=function(){return this.hammer&&(this.hammer.get("pinch").options.enable=!0),this},t.disable=function(){return this.hammer&&(this.hammer.get("pinch").options.enable=!1),this},t.isEnable=function(){return!(!this.hammer||!this.hammer.get("pinch").options.enable)},e}(),Lt=0,jt=-1,Kt=-1;function Rt(e,t,n,i,r){var o=Date.now?Date.now():(new Date).getTime();e||(jt===n&&Kt===i&&o-Lt<=500&&r(t,n,i),jt=n,Kt=i,Lt=o)}var Ft=function(e,t){return(Ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var Nt,Xt=(function(e,t){function n(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return a[e];var n,i=String(e);return(n=r[i.toLowerCase()])?n:(n=o[i.toLowerCase()])||(1===i.length?i.charCodeAt(0):void 0)}n.isEventKey=function(e,t){if(e&&"object"==typeof e){var n=e.which||e.keyCode||e.charCode;if(null==n)return!1;if("string"==typeof t){var i;if(i=r[t.toLowerCase()])return i===n;if(i=o[t.toLowerCase()])return i===n}else if("number"==typeof t)return t===n;return!1}};var r=(t=e.exports=n).code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},o=t.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(i=97;i<123;i++)r[String.fromCharCode(i)]=i-32;for(var i=48;i<58;i++)r[i-48]=i;for(i=1;i<13;i++)r["f"+i]=i+111;for(i=0;i<10;i++)r["numpad "+i]=i+96;var a=t.names=t.title={};for(i in r)a[r[i]]=i;for(var s in o)r[s]=o[s]}(Nt={exports:{}},Nt.exports),Nt.exports),Yt=(Xt.code,Xt.codes,Xt.aliases,Xt.names);Xt.title;function qt(e,t,n,i){e.addEventListener(t,n,i)}var Ht={"+":"plus","left command":"meta","right command":"meta"},Wt={shift:1,ctrl:2,alt:3,meta:4};var Bt=function(n){function e(e){void 0===e&&(e=window);var t=n.call(this)||this;return t.ctrlKey=!1,t.altKey=!1,t.shiftKey=!1,t.metaKey=!1,t.clear=function(){t.ctrlKey=!1,t.altKey=!1,t.shiftKey=!1,t.metaKey=!1},t.keydownEvent=function(e){t.triggerEvent("keydown",e)},t.keyupEvent=function(e){t.triggerEvent("keyup",e)},qt(e,"blur",t.clear),qt(e,"keydown",t.keydownEvent),qt(e,"keyup",t.keyupEvent),t}!function(e,t){function n(){this.constructor=e}Ft(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,n);var t=e.prototype;return t.keydown=function(e,t){return this.addEvent("keydown",e,t)},t.keyup=function(e,t){return this.addEvent("keyup",e,t)},t.addEvent=function(e,t,n){return!function(e){return Array.isArray(e)}(t)?!function(e){return"string"==typeof e}(t)?this.on(e,t):this.on(e+"."+t,n):this.on(e+"."+function(e){var t=e.slice();return t.sort(function(e,t){return(Wt[e]||5)-(Wt[t]||5)}),t}(t).join("."),n),this},t.triggerEvent=function(e,t){this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey;var n=function(e){var t=Yt[e]||"";for(var n in Ht)t=t.replace(n,Ht[n]);return t.replace(/\s/g,"")}(t.keyCode),i={key:n,isToggle:"ctrl"===n||"shift"===n||"meta"===n||"alt"===n,inputEvent:t,keyCode:t.keyCode,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey};this.trigger(e,i),this.trigger(e+"."+n,i);var r=function(e,t){var n=[e.shiftKey&&"shift",e.ctrlKey&&"ctrl",e.altKey&&"alt",e.metaKey&&"meta"];return-1===n.indexOf(t)&&n.push(t),n.filter(Boolean)}(t,n);1<r.length&&this.trigger(e+"."+r.join("."),i)},e}(it),Ut="undefined";function Vt(e){return typeof e===Ut}function Zt(e){return[].concat(e)}function $t(n,e,t,i){void 0===i&&(i=0);var r=e.children,o=n(e);return e.element=o,e.ref&&e.ref(e,i),r&&Zt(r).filter(function(e){return e}).forEach(function(e,t){$t(n,e,o,t)}),t&&t.appendChild(o),e}function Gt(i,r,e,t,n){var o=Zt(e||[]),a=Zt(t||[]),s=function(n,i,r){var e=n.map(function(e,t){var n=e.key;return Vt(n)?t:n}),t=i.map(function(e,t){var n=e.key;return Vt(n)?t:n}),o={},a={},s=[],u=[],c=[];e.forEach(function(e,t){o[e]=t}),t.forEach(function(e,t){e in o?r(n[o[e]],i[t],t):s.push(t),a[e]=t}),e.forEach(function(e,t){var n=a[e];Vt(n)?u.push(t):t!==n&&c.push([t,n])}),c.sort(function(e,t){return e[1]>t[1]?1:-1}),c.length&&console.log(c);var l=[],h=[-1,-1];return c.forEach(function(e){h[0]>e[0]&&l.push(h),h=e}),{added:s,removed:u,changed:l}}(o,a||[],function(e,t,n){t.element=e.element,t.ref&&t.ref(t,n),r(e,t),Gt(i,r,e.children,t.children,t)}),u=s.added,c=s.changed,l=s.removed;if(u.length&&".properties_scroll_area"===n.selector&&console.log(u,c,l),n){var h=n.element;c.forEach(function(e){e[0];var t=e[1];h.insertBefore(a[t].element,a[t+1].element)}),l.reverse().forEach(function(e){h.removeChild(o[e].element)}),u.forEach(function(e){var t=$t(i,a[e]).element;h.insertBefore(t,a[e+1]&&a[e+1].element)}),t&&(n.children=t)}}var Qt=function(){function e(e,t){this.createElement=e,this.updateElement=t}var t=e.prototype;return t.render=function(e,t){return $t(this.createElement,e,t)},t.update=function(e,t,n){return Gt(this.createElement,this.updateElement,e,t,n),this},e}();function Jt(t,e,n,i){return{ref:function(e){t.keyframesAreas[0]=e},selector:".keyframes_area",children:{style:{minWidth:50*i+"px",width:Math.min(n?i/n:1,2)*e*100+"%"},dataset:{width:Math.min(n?i/n:1,2)},ref:function(e){t.keyframesScrollAreas[0]=e},selector:".keyframes_scroll_area",children:{ref:function(e){t.cursors=[]},selector:".keyframes",children:[{ref:function(e){t.keytimesContainer=e},selector:".keyframes_container",children:function(e){for(var t=[],n=0;n<=e;++n)t.push({key:n,dataset:{time:n},selector:".keytime",style:{width:100/e+"%"},children:[{selector:"span",html:""+n},{selector:".graduation.start"},{selector:".graduation.quarter"},{selector:".graduation.half"},{selector:".graduation.quarter3"}]});return t}(i)},{selector:".keyframe_cursor",ref:function(e){t.cursors[0]=e}}]}}}}function en(t,e,n,i,r){var o=Math.min(i?r/i:1,2);return{ref:function(e){t.keyframesAreas[1]=e},selector:".keyframes_area",children:{style:{minWidth:50*r+"px",width:o*n*100+"%"},dataset:{width:o},ref:function(e){t.keyframesScrollAreas[1]=e},selector:".keyframes_scroll_area",children:function(t,e,n){return e.concat([{key:"cursor",selector:".keyframe_cursor",ref:function(e){t.cursors[1]=e}},{key:"lineArea",ref:function(e){t.lineArea=e},selector:".line_area",children:function(e){for(var t=[],n=0;n<=e;++n)t.push({key:n,selector:".division_line",style:{left:100/e*n+"%"}});return t}(n)}])}(t,e,r)}}}function tn(e,h){var f=[],p=e.item.getDuration(),d=e.frames,m=[];return d.map(function(e,t){var n=e[0],i=e[1],r=e[2],o=g(r);if(d[t+1]){var a=d[t+1],s=a[0],u=a[1],c=a[2],l=g(c);(0===i&&0===u||i===p&&u===p)&&m.push(function(e,t,n){return{selector:".keyframe_delay",key:"delay"+e+","+t,datas:{time:-1},style:{left:e/n*100+"%",width:(t-e)/n*100+"%"}}}(n,s,h)),v(r)||v(c)||o===l||f.push({selector:".keyframe_line",key:n+","+s,datas:{time:n+","+s,from:n,to:s},style:{left:n/h*100+"%",width:(s-n)/h*100+"%"}})}return{key:n,selector:".keyframe",dataset:{time:n},datas:{time:n,iterationTime:i,value:o},style:{left:n/h*100+"%"},html:n+" "+o}}).concat(m,f)}function nn(t,e,n,i,r){var o=function(n,e,t){var i=[];for(var r in e){var o=e[r],a=tn(o,t);i.push({ref:function(e,t){n.keyframesList[t]=e,n.keyframesContainers[t]=e.children},selector:".keyframes",key:r,dataset:{item:o.isItem?"1":"0",key:r},datas:o,children:{selector:".keyframes_container",children:a}})}return i}(t,e,r);return{ref:function(e){t.scrollArea=e,t.keyframesList=[],t.keyframesContainers=[]},selector:".scroll_area",children:[{ref:function(e){t.propertiesAreas[1]=e,t.properties=[]},selector:".properties_area",children:[{selector:".properties_scroll_area",children:function(n,e){var t=[];for(var i in e){var r=e[i],o=i.split("///"),a=o.length,s=o[a-1];t.push({ref:function(e,t){n.properties[t]=e},key:i,selector:".property",dataset:{key:i,object:r.isParent?"1":"0",item:r.isItem?"1":"0"},datas:r,style:{paddingLeft:10+20*(a-1)+"px"},children:[{selector:".arrow"},{selector:"span",html:s},{selector:".remove"}]})}return t}(t,e)}]},{ref:function(e){t.valuesArea=e,t.values=[]},selector:".values_area",children:function(n,e){var t=[];for(var i in e){var r=e[i],o=r.frames;t.push({ref:function(e,t){n.values[t]=e},key:i,selector:".value",dataset:{key:i,item:r.isItem?"1":"0",object:r.isParent?"1":"0"},datas:r,children:r.isParent?{key:"add",selector:".add",html:"+"}:{key:"input",selector:"input",attr:{value:o[0]?o[0][1]:""}}})}return t}(t,e)},en(t,o,n,i,r)]}}function rn(e,t){return{selector:".option_area",children:[{selector:".option_name",html:e},{selector:".option_value",dataset:{option:e},children:{selector:"input",dataset:{option:e},ref:function(e){e.element.value=v(t)?"":t}}}]}}function on(e){return[rn("delay",e&&e.getDelay()),rn("easing",e&&e.getEasingName()),rn("iterationCount",e&&e.getIterationCount()),rn("playSpeed",e&&e.getPlaySpeed()),rn("fillMode",e&&e.getFillMode()),rn("direction",e&&e.getDirection()),rn("duration",e&&e.getDuration()),rn("lastFrame",e&&e.getDuration())]}var an=function(){function e(e,t){var n=this;this.timeline=e,this.select=function(e){n.selectedItem=e.selectedItem,n.update()},e.on("select",this.select),this.datadom=new Qt(c,l),this.selectedItem=e.scene,this.infoArea=this.datadom.render({selector:".item_info",children:[{selector:"style",html:i},{ref:function(e){n.optionArea=e},selector:".options_area",children:on(e.scene)}]},t),this.init()}var t=e.prototype;return t.update=function(){this.datadom.update(this.optionArea.children,on(this.selectedItem),this.optionArea)},t.init=function(){var a=this;new Bt(this.infoArea.element).keydown(function(e){e.inputEvent.stopPropagation()}).keyup(function(e){e.inputEvent.stopPropagation()}).keyup("enter",function(e){var t=a.selectedItem;if(a.selectedItem){var n=y(e.inputEvent.target,function(e){return"INPUT"===e.nodeName});if(n){var i=n.getAttribute("data-option"),r=n.value;if("delay"===i)t.setDelay(parseFloat(r));else if("lastFrame"===i){var o=parseFloat(r);(function(e){return!!e.constructor.prototype.getFrame})(t)&&t.getDuration()<o&&t.newFrame(o)}else"playSpeed"===i?t.setPlaySpeed(parseFloat(r)):"direction"===i?t.setDirection(r):"iterationCount"===i?t.setIterationCount("infinite"===r?r:parseFloat(r)):"easing"===i&&t.setEasing(r);a.timeline.update(),a.update()}}})},e}(),sn=1e6;function un(e){return Math.round(e*sn)/sn}function cn(e,t,n){var i=e[e.length-1];(!i||i[0]!==t||i[1]!==n)&&e.push([un(t),un(n)])}function ln(c,e,l,h){h.update();var f=function(e,t){if(!e.length)return[];var b=e.map(function(e){return[e,e]}),k=[];return 0!==b[0][0]&&t[t.length-1][E]&&b.unshift([0,0]),t.forEach(function(e){for(var t,n,i=e[w],r=e[E],o=e[T],a=e[_],s=Math.ceil(i),u=b[b.length-1][0],c=b.length,l=u*i,h=0;h<s;++h)for(var f=a===A||a===P&&h%2||a===I&&!(h%2),p=0;p<c;++p){var d=b[f?c-p-1:p],m=d[1],v=u*h+(f?u-d[0]:d[0]),g=b[f?c-p:p-1];if(l<v){if(0!==p){var y=u*h+(f?u-g[0]:g[0]),x=(g[1]*(n=v-l)+m*(t=l-y))/(t+n);cn(k,(r+u*i)/o,x)}break}if(v===l&&k[k.length-1][0]===l+r)break;cn(k,(r+v)/o,m)}r&&k.unshift([0,k[0][1]]),b=k,k=[]}),b}(h.times,e.map(function(e){return e.state}));console.log(f),function e(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=[],i=p(t),a=0===r.length;f.forEach(function(e){var t=e[0],n=e[1],i=h.get.apply(h,[n].concat(r));v(i)&&r.length||o.push([t,n,i])});var s=l.concat(r).join("///");if(c[s]={key:s,parentItem:null,isParent:i,isItem:a,item:h,names:l,properties:r,frames:o},i)for(var u in t)e.apply(void 0,[t[u]].concat(r,[u]))}(h.names)}function hn(e){var s={};return function t(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var i=n.length,r=n[i-1],o=n.slice(1).map(function(e){return e.getId()});if(C(r)){if(o.length){var a=o.join("///");s[a]={key:a,isItem:!0,isParent:!0,parentItem:n[i-2],item:r,names:[],properties:[],frames:[]}}r.forEach(function(e){t.apply(void 0,n.concat([e]))})}else ln(s,n,o,r)}(e),s}var fn=!1;return function(i){function e(e,t){var n=i.call(this)||this;return n.maxTime=0,n.selectedProperty="",n.selectedTime=-1,n.ids={},e.finish(),n.scene=e,n.initStructure(e,t),n.initEditor(),n.initScroll(),n.initWheelZoom(),n.initDragKeyframes(),n.initClickProperty(),n.initController(),n.initDragValues(),n.initKeyController(),e.setTime(0),new an(n,t),n}!function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,i);var t=e.prototype;return t.getElement=function(){return this.structure.element},t.prev=function(){this.scene.setTime(this.scene.getTime()-.05)},t.next=function(){this.scene.setTime(this.scene.getTime()+.05)},t.finish=function(){this.scene.finish()},t.togglePlay=function(){var e=this.scene;"running"===e.getPlayState()?e.pause():e.play()},t.update=function(){var e=this.scene;this.timelineInfo=hn(e);var t=Math.ceil(e.getDuration()),n=t,i=this.axes.get(["zoom"]).zoom,r=this.maxTime;this.maxTime=n;var o=this.ids,a=o.keyframesAreas[0];i*=5<r?t/r:1,this.axes.axm.set({zoom:i}),this.datadom.update(a,Jt(o,i,t,n));var s=nn(o,this.timelineInfo,this.axes.get(["zoom"]).zoom,t,this.maxTime);console.log(o.scrollArea.children[0].children[0].children.map(function(e){return e.key})),console.log(s.children[0].children[0].children.map(function(e){return e.key})),this.datadom.update(o.scrollArea,s),e.setTime(e.getTime())},t.initController=function(){var n=this,r=this.ids,e=this.ids.playBtn.element,o=this.scene;this.ids.addItem.element.addEventListener("click",function(e){var t=prompt("Add Item");t&&(n.scene.newItem(t),n.update())}),e.addEventListener("click",function(e){n.togglePlay(),e.preventDefault()}),r.unselectedArea.element.addEventListener("click",function(e){n.select("",-1)}),r.prevBtn.element.addEventListener("click",function(e){n.prev(),e.preventDefault()}),r.nextBtn.element.addEventListener("click",function(e){n.next(),e.preventDefault()}),o.on("play",function(){b(e,"pause"),k(e,"play")}),o.on("paused",function(){b(e,"play"),k(e,"pause")}),new Bt(r.timeArea.element).keydown(function(e){!e.isToggle&&e.inputEvent.stopPropagation()}).keyup(function(e){!e.isToggle&&e.inputEvent.stopPropagation()}).keyup("enter",function(e){var t=r.timeArea.element.value,n=/(\d+):(\d+):(\d+)/g.exec(t);if(n){var i=60*parseFloat(n[1])+parseFloat(n[2])+parseFloat("0."+n[3]);o.setTime(i)}})},t.initKeyController=function(){var t=this,e=this.ids;window.addEventListener("blur",function(){k(e.timeline.element,"alt")}),this.keycon=(new Bt).keydown("space",function(e){e.inputEvent.preventDefault()}).keydown("left",function(e){t.prev()}).keydown("right",function(e){t.next()}).keyup("backspace",function(){t.removeKeyframe(t.selectedProperty)}).keydown("alt",function(){b(e.timeline.element,"alt")}).keyup("alt",function(){k(e.timeline.element,"alt")}).keyup("esc",function(){t.finish()}).keyup("space",function(){t.togglePlay()})},t.initStructure=function(e,t){this.timelineInfo=hn(e);var n,i=Math.ceil(e.getDuration()),r=Math.ceil(i),o=r,a=this.ids;this.maxTime=o,fn||(n={selector:"style.style",html:u},fn=!0);var s={selector:".timeline",ref:function(e){a.timeline=e},children:[n,function(t){return{selector:".header_area.control_area",children:[{selector:".properties_area",ref:function(e){t.unselectedArea=e},children:{selector:".property"}},{selector:".values_area",children:{selector:".value"}},{selector:".keyframes_area",children:{selector:".keyframes",children:[{selector:"input.time_area",ref:function(e){t.timeArea=e},html:"???"},{selector:".play_control_area",children:[{ref:function(e){t.prevBtn=e},selector:".control.prev"},{ref:function(e){t.playBtn=e},selector:".control.play"},{ref:function(e){t.nextBtn=e},selector:".control.next"}]}]}}]}}(a),function(t,e,n,i){return{selector:".header_area",ref:function(e){t.keyframesScrollAreas=[],t.keyframesAreas=[],t.propertiesAreas=[]},children:[{ref:function(e){t.propertiesAreas[0]=e},selector:".properties_area",children:[{selector:".property",html:"Name"}]},{selector:".values_area",children:{selector:".value",children:{key:"add",selector:".add",html:"+",ref:function(e){t.addItem=e}}}},Jt(t,e,n,i)]}}(a,1,r,o),nn(a,this.timelineInfo,1,r,o)]};this.datadom=new Qt(c,l),this.structure=this.datadom.render(s,t)},t.initScroll=function(){var e=this.ids.keyframesAreas,t=!1,n=e[0].element,i=e[1].element;n.addEventListener("scroll",function(){t?t=!1:(t=!0,i.scrollLeft=n.scrollLeft)}),i.addEventListener("scroll",function(){t?t=!1:(t=!0,n.scrollLeft=i.scrollLeft)})},t.initWheelZoom=function(){var n=this,i=this.ids,e=i.keyframesScrollAreas,t=e[0].element,r=e[1].element,o=new Ct({zoom:{range:[1,1/0]}},{},{zoom:1});o.connect("zoom",new Mt(r,{scale:.1,hammerManagerOptions:{touchAction:"auto"}})),o.on("hold",function(e){e.inputEvent&&e.inputEvent.preventDefault()}),o.on("change",function(e){var t=i.keyframesScrollAreas[0].dataset.width,n=e.pos.zoom*t*100;i.keyframesScrollAreas.forEach(function(e){e.element.style.width=n+"%"}),e.inputEvent&&e.inputEvent.preventDefault()}),this.axes=o,t.addEventListener("wheel",function(e){var t=e.deltaY;o.setBy({zoom:t/5e3}),!e.deltaX&&e.preventDefault()}),a(r,"wheel",function(e){if(n.keycon.altKey){e.preventDefault();var t=e.deltaY;o.setBy({zoom:t/5e3})}})},t.select=function(e,t){var n=this.selectedProperty,i=this.selectedTime,r=this.ids,o=r.values,a=r.properties,s=r.keyframesList;if(this.selectedProperty=e,this.scene.pause(),n){var u=m(n,a);if(k(a[u].element,"select"),k(o[u].element,"select"),k(s[u].element,"select"),0<=i)r.keyframesContainers[u].children.forEach(function(e){e.datas.time===i&&k(e.element,"select")}),this.selectedTime=-1}var c=this.scene;if(e){document.activeElement&&document.activeElement.blur();var l=m(e,a);if(b(a[l].element,"select"),b(o[l].element,"select"),b(s[l].element,"select"),c=r.keyframesList[l].datas.item,0<=t)r.keyframesContainers[l].children.forEach(function(e){e.datas.time===t&&b(e.element,"select")}),this.selectedTime=t}this.trigger("select",{selectedItem:c,selectedProperty:this.selectedProperty,selectedTime:this.selectedTime,prevSelectedProperty:n,prevSelectedTime:i})},t.initClickProperty=function(){var s=this,u=this.ids;u.propertiesAreas[1].element.addEventListener("click",function(e){var t=u.properties.map(function(e){return e.element}),n=(t.length,y(e.target,function(e){return x(e,"arrow")})),i=y(e.target,function(e){return x(e,"remove")}),r=y(e.target,function(e){return x(e,"property")});if(r){var o=t.indexOf(r);if(-1!==o){var a=u.properties[o];i?s.remove(a.datas):(s.select(a.dataset.key),n&&s.fold(o))}}})},t.setInputs=function(e){var t=this.ids.valuesArea.element;for(var n in e)t.querySelector('[data-key="'+n+'"] input').value=e[n]},t.moveCursor=function(e){var t=this.ids.cursors,n=this.maxTime,i="calc("+100*e/n+"% + "+(15-30*e/n)+"px)";t.forEach(function(e){e.element.style.left=i})},t.initDragKeyframes=function(){var s=this,u=this.ids,r=u.scrollArea,o=u.timeArea,e=u.cursors,a=u.keyframesAreas,c=u.keyframesScrollAreas,l=this.scene;l.on("animate",function(e){var t=e.time;s.moveCursor(t),s.setInputs(function e(t,n){for(var i in void 0===n&&(n={}),t){var r=t[i];if(p(r)){var o=e(r.constructor.prototype.toCSS?r.get():r);for(var a in o)n[i+"///"+a]=o[a]}else n[i]=r}return n}(e.frames));var n=d(Math.floor(t/60),2),i=d(Math.floor(t%60),2),r=d(Math.floor(t%1*100),3,!0);o.element.value=n+":"+i+":"+r});var h=function(e){var t=c[1].element.getBoundingClientRect(),n=t.width-30,i=t.left+15,r=Math.min(n,Math.max(e-i,0))/n,o=s.maxTime*r;return o=Math.round(20*o)/20},f=function(e,t,n){var i=D(u.keyframesList.map(function(e){return e.element}),n);-1!==i&&s.addKeyframe(i,h(t))};O(e[0].element,{dragstart:function(e){e.inputEvent.stopPropagation()},drag:function(e){!function(e){l.setTime(h(e))}(e.clientX)},container:window}),c.forEach(function(e){O(e.element,{container:window,drag:function(e){var t=e.deltaX,n=e.deltaY,i=e.inputEvent;a[1].element.scrollLeft-=t,r.element.scrollTop-=n,i.preventDefault()},dragend:function(e){var t=e.isDrag,n=e.clientX,i=e.clientY,r=e.inputEvent;!t&&function(e,t,n){var i=y(e.target,function(e){return x(e,"keyframe")}),r=i?parseFloat(i.getAttribute("data-time")):h(t);l.setTime(r);var o=u.keyframesList,a=D(o.map(function(e){return e.element}),n);-1<a&&s.select(o[a].dataset.key,r),e.preventDefault()}(r,n,i),Rt(t,r,n,i,f)}})})},t.initDragValues=function(){var n,s=this,u=this.ids,e=u.valuesArea.element,c=null;a(e,"click",function(e){var t=y(c,function(e){return x(e,"add")});if(t){var n=m(t.parentElement.getAttribute("data-key"),u.values);if(!(n<0)){var i=prompt("add property"),r=u.properties[n].datas,o=r.properties.slice(),a=r.item;a.set.apply(a,[a.getIterationTime()].concat(o,[i,0])),s.update()}}}),O(e,{container:window,dragstart:function(e){if(c=e.inputEvent.target,n=c.value,!s.keycon.altKey||!y(c,function(e){return"INPUT"===e.nodeName}))return!1},drag:function(t){var e=n.replace(/-?\d+/g,function(e){return""+(parseFloat(e)+Math.round(t.distX/2))});c.value=e},dragend:function(e){s.edit(c,c.value)}})},t.addKeyframe=function(e,t){var n=this.ids.keyframesList,i=n[e].dataset.key,r=n[e].datas;r.item,r.properties;this.select(i,t);var o=this.ids.values[e].children.element.value;this.editKeyframe(e,o)},t.fold=function(e){var t,n=this.ids,i=n.properties,r=n.values,o=n.keyframesList,a=i[e],s=i.length;for(t=e;t<s&&0===i[t].datas.key.indexOf(a.datas.key);++t);var u=i.slice(e+1,t),c=r.slice(e+1,t),l=o.slice(e+1,t),h=a.element,f="1"===h.getAttribute("data-fold");h.setAttribute("data-fold",f?"0":"1");var p=f?k:b;u.forEach(function(e,t){p(e.element,"fold"),p(c[t].element,"fold"),p(l[t].element,"fold")})},t.remove=function(e){var t=e.key,n=e.isItem,i=e.parentItem,r=e.item,o=e.properties;if(n){var a=null;i.forEach(function(e,t){e!==r||(a=t)}),null!=a&&i.removeItem(a)}else{r.times.forEach(function(e){var t;(t=r).remove.apply(t,[e].concat(o))})}this.selectedProperty===t&&(this.selectedProperty="",this.selectedTime=-1),this.update()},t.removeKeyframe=function(e){var t=this.timelineInfo[e];if(e&&t&&!C(t.item)){var n=t.properties,i=t.item;i.remove.apply(i,[i.getIterationTime()].concat(n)),this.update()}},t.editKeyframe=function(e,t){var n=this.ids;if(!("1"===n.properties[e].dataset.object)){var i=n.keyframesList[e].datas,r=i.item,o=i.properties;console.log(o),r.set.apply(r,[r.getIterationTime()].concat(o,[t])),this.update()}},t.restoreKeyframes=function(){this.scene.setTime(this.scene.getTime())},t.edit=function(e,t){var n=y(e,function(e){return x(e,"value")});if(n){var i=this.ids.values.map(function(e){return e.element}).indexOf(n);-1!==i&&this.editKeyframe(i,t)}},t.initEditor=function(){var n=this,e=this.ids.valuesArea.element;new Bt(e).keydown(function(e){!e.isToggle&&e.inputEvent.stopPropagation()}).keyup(function(e){!e.isToggle&&e.inputEvent.stopPropagation()}).keyup("enter",function(e){var t=e.inputEvent.target;n.edit(t,t.value)}).keyup("esc",function(e){e.inputEvent.target.blur()}),e.addEventListener("focusout",function(e){n.restoreKeyframes()})},e}(it)});
//# sourceMappingURL=timeline.pkgd.min.js.map
