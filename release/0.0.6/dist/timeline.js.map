{"version":3,"file":"timeline.js","sources":["../src/consts.ts","../src/utils.ts","../src/dblcheck.ts","../src/KeytimesStructure.ts","../src/HeaderAreaStructure.ts","../src/KeyframesStructure.ts","../src/PropertiesStructure.ts","../src/ValuesStructure.ts","../src/ScrollAreaStructure.ts","../src/ControlAreaStructure.ts","../src/Info.ts","../src/TimelineInfo.ts","../src/Timeline.ts"],"sourcesContent":["export const PREFIX = `scenejs_editor_`;\n\nexport const CSS2 = `\n.item_info {\n    position: fixed;\n    right: 0;\n    top: 0;\n    width: 200px;\n    background: #000;\n}\n.options_area {\n\n}\n.option_area {\n    position: relative;\n    border-bottom: 1px solid #777;\n    box-sizing: border-box;\n    white-space: nowrap;\n    background: rgba(90, 90, 90, 0.7);\n    font-size: 13px;\n    font-weight: bold;\n    color: #eee;\n    display: flex;\n}\n.option_name, .option_value {\n    width: 50%;\n    height: 30px;\n    line-height: 20px;\n    box-sizing: border-box;\n    padding: 5px;\n}\n.option_name {\n    border-right: 1px solid #999;\n}\n.option_value input {\n    appearance: none;\n    -webkit-appearance: none;\n    outline: none;\n    position: relative;\n    display: block;\n    width: 100%;\n    height: 100%;\n    background: transparent;\n    color: #4af;\n    font-weight: bold;\n    background: none;\n    border: 0;\n    box-sizing: border-box;\n}\n`.replace(/\\.([^{,\\s\\d.]+)/g, `.${PREFIX}$1`);\n\nexport const CSS = `\n.timeline {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  font-size: 0;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n}\n.header_area, .scroll_area {\n   width: 100%;\n   position: relative;\n  display: flex;\n  -webkit-align-items: flex-start;\n  align-items: flex-start;\n}\n.header_area {\n  position: relative;\n  z-index: 10;\n  top: 0;\n  height: 30px;\n  min-height: 30px;\n}\n.header_area .keyframes {\n  padding: 0px;\n}\n.header_area .properties_area,\n.header_area .keyframes_area,\n.header_area .values_area,\n.header_area .keyframes_scroll_area {\n    height: 100%;\n}\n.header_area .property, .header_area .value, .header_area .keyframes {\n  height: 100%;\n}\n.header_area .property {\n    line-height: 30px;\n}\n.header_area .value {\n    text-align: center;\n    color: #fff;\n    line-height: 30px;\n    font-weight: bold;\n    font-size: 20px;\n}\n.header_area .keyframes_area::-webkit-scrollbar {\n    display: none; // Safari and Chrome\n}\n.header_area .keyframe_cursor {\n    position: absolute;\n    border-top: 10px solid #4af;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    width: 0;\n    height: 0;\n    bottom: 0;\n    top: auto;\n    background: none;\n    cursor: pointer;\n}\n.control_area .keyframes {\n    padding-left: 10px;\n}\n.play_control_area {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n.play_control_area .control {\n    position: relative;\n    display: inline-block;\n    vertical-align: middle;\n    color: white;\n    margin: 0px 15px;\n}\n.play {\n    border-left: 14px solid white;\n    border-top: 8px solid transparent;\n    border-bottom: 8px solid transparent;\n}\n.pause {\n    border-left: 4px solid #fff;\n    border-right: 4px solid #fff;\n    width: 6px;\n    height: 16px;\n}\n.prev {\n    border-right: 10px solid white;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n}\n.prev:before {\n    position: absolute;\n    content: \"\";\n    width: 3px;\n    height: 10px;\n    top: 0;\n    right: 100%;\n    transform: translate(0, -50%);\n    background: white;\n}\n.next {\n    border-left: 10px solid white;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n}\n.next:before {\n    position: absolute;\n    content: \"\";\n    width: 3px;\n    height: 10px;\n    top: 0;\n    transform: translate(0, -50%);\n    background: white;\n}\n.keytime {\n  position: relative;\n  display: inline-block;\n  height: 100%;\n  font-size: 13px;\n  font-weight: bold;\n  color: #777;\n}\n.keytime:last-child {\n  max-width: 0px;\n}\n.keytime span {\n  position: absolute;\n  top: 2px;\n  left: 0;\n  display: inline-block;\n  transform: translate(-50%);\n  color: #eee;\n}\n.keytime .graduation {\n  position: absolute;\n  bottom: 0;\n  width: 1px;\n  height: 10px;\n  background: #777;\n  transform: translate(-50%);\n}\n.keytime .graduation.half {\n  left: 50%;\n  height: 7px;\n}\n.keytime .graduation.quarter {\n  left: 25%;\n  height: 5px;\n}\n.keytime .graduation.quarter3 {\n  left: 75%;\n  height: 5px;\n}\n.scroll_area {\n  position: relative;\n  width: 100%;\n  height: calc(100% - 60px);\n  overflow: auto;\n}\n.properties_area, .keyframes_area, .values_area {\n  display: inline-block;\n  position: relative;\n  font-size: 16px;\n  overflow: auto;\n}\n\n.properties_area::-webkit-scrollbar, .keyframes_area::-webkit-scrollbar {\n    display: none; // Safari and Chrome\n}\n.properties_area {\n  width: 30%;\n  max-width: 200px;\n  box-sizing: border-box;\n}\n.values_area {\n    width: 50px;\n    min-width: 50px;\n    display: inline-block;\n    border-right: 1px solid #999;\n    box-sizing: border-box;\n}\n.value input {\n    appearance: none;\n    -webkit-appearance: none;\n    outline: none;\n    position: relative;\n    display: block;\n    width: 100%;\n    height: 100%;\n    background: transparent;\n    color: #4af;\n    font-weight: bold;\n    background: none;\n    border: 0;\n    box-sizing: border-box;\n    text-align: center;\n}\n.alt .value input {\n    cursor: ew-resize;\n}\n.value[data-object=\"1\"] input {\n    display: none;\n}\n.properties_scroll_area {\n  display: inline-block;\n  min-width: 100%;\n}\n.keyframes_area {\n  flex: 1;\n}\n.keyframes_scroll_area {\n  position: relative;\n  min-width: 300px;\n}\n.keyframes, .property, .value {\n  position: relative;\n  height: 25px;\n  border-bottom: 1px solid #777;\n  box-sizing: border-box;\n  white-space: nowrap;\n  background: rgba(90, 90, 90, 0.7);\n  z-index: 1;\n}\n\n.property {\n  line-height: 25px;\n  padding-left: 10px;\n  box-sizing: border-box;\n  font-size: 13px;\n  font-weight: bold;\n  color: #eee;\n}\n.time_area {\n    font-size: 13px;\n    color: #4af;\n    line-height: 30px;\n    font-weight: bold;\n    height: 100%;\n    line-height: 30px;\n    border: 0;\n    background: transparent;\n    outline: 0;\n}\n.time_area:after {\n    content: \"s\";\n}\n.property .arrow {\n    position: relative;\n    display: inline-block;\n    margin-right: 5px;\n    width: 0;\n    vertical-align: middle;\n    cursor: pointer;\n    border-top: 6px solid #eee;\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n}\n.property[data-fold=\"1\"] .arrow {\n    border-top: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-right: 0;\n    border-left: 6px solid #eee;\n    margin-left: 2px;\n}\n.property[data-object=\"0\"] .arrow {\n    display: none;\n}\n.property.fold, .keyframes.fold, .value.fold {\n    display: none;\n}\n.property.select, .value.select, .keyframes.select {\n    background: rgba(120, 120, 120, 0.7);\n}\n.keyframes {\n\n}\n.keyframe_delay {\n  position: absolute;\n  height: 100%;\n  top: 0;\n  left: 0;\n  background: #4af;\n  opacity: 0.2;\n  z-index: 0;\n}\n.keyframe_line {\n  position: absolute;\n  height: 8px;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  background: #666;\n  z-index: 0;\n}\n.keyframe {\n  position: absolute;\n  font-size: 0px;\n  width: 12px;\n  height: 12px;\n  top: 0px;\n  bottom: 0px;\n  margin: auto;\n  background: #fff;\n  border: 2px solid #383838;\n  border-radius: 2px;\n  box-sizing: border-box;\n  transform: translate(-50%) rotate(45deg);\n  z-index: 1;\n  cursor: pointer;\n}\n.keyframe[data-no=\"1\"] {\n    opacity: 0.2;\n}\n.select .keyframe {\n    border-color: #555;\n}\n.keyframe.select {\n    background: #4af;\n}\n.keyframes_container, .line_area {\n  position: relative;\n  width: calc(100% - 30px);\n  left: 15px;\n  height: 100%;\n}\n.line_area {\n  position: absolute;\n  top: 0;\n  z-index: 0;\n}\n.keyframe_cursor {\n  position: absolute;\n  top: 0;\n  z-index: 1;\n  background: #4af;\n  width: 1px;\n  height: 100%;\n  left: 15px;\n  transform: translate(-50%);\n}\n.division_line {\n  position: absolute;\n  background: #333;\n  width: 1px;\n  height: 100%;\n  transform: translate(-50%);\n}\n`.replace(/\\.([^{,\\s\\d.]+)/g, `.${PREFIX}$1`);\n\nexport const DURATION = \"duration\";\nexport const FILL_MODE = \"fillMode\";\nexport const DIRECTION = \"direction\";\nexport const ITERATION_COUNT = \"iterationCount\";\nexport const DELAY = \"delay\";\nexport const EASING = \"easing\";\nexport const PLAY_SPEED = \"playSpeed\";\nexport const EASING_NAME = \"easingName\";\nexport const ITERATION_TIME = \"iterationTime\";\nexport const PAUSED = \"paused\";\nexport const ENDED = \"ended\";\nexport const TIMEUPDATE = \"timeupdate\";\nexport const ANIMATE = \"animate\";\nexport const PLAY = \"play\";\nexport const RUNNING = \"running\";\nexport const ITERATION = \"iteration\";\nexport const START_ANIMATION = \"startAnimation\";\nexport const PAUSE_ANIMATION = \"pauseAnimation\";\nexport const ALTERNATE = \"alternate\";\nexport const REVERSE = \"reverse\";\nexport const ALTERNATE_REVERSE = \"alternate-reverse\";\nexport const NORMAL = \"normal\";\nexport const INFINITE = \"infinite\";\nexport const PLAY_STATE = \"playState\";\nexport const PLAY_CSS = \"playCSS\";\nexport const PREV_TIME = \"prevTime\";\nexport const TICK_TIME = \"tickTime\";\nexport const CURRENT_TIME = \"currentTime\";\nexport const SELECTOR = \"selector\";\nexport const TRANSFORM_NAME = \"transform\";\n","import { PREFIX } from \"./consts\";\nimport Scene, { SceneItem, Frame } from \"scenejs\";\nimport {\n    hasClass as hasClass2,\n    addClass as addClass2,\n    removeClass as removeClass2,\n    IObject,\n    isObject,\n    isArray,\n    isUndefined,\n} from \"@daybrush/utils\";\nimport { ElementStructure, TimelineInfo } from \"./types\";\n\nexport function numberFormat(num: number, count: number, isRight?: boolean) {\n    const length = `${num}`.length;\n    const arr = [];\n\n    if (isRight) {\n        arr.push(num);\n    }\n    for (let i = length; i < count; ++i) {\n        arr.push(0);\n    }\n    if (!isRight) {\n        arr.push(num);\n    }\n    return arr.join(\"\");\n}\nexport function applyStyle(el: HTMLElement, style: IObject<any>) {\n    for (const name in style) {\n        el.style[name] = style[name];\n    }\n}\nexport function findIndexByProperty(selectedProperty: string, structures: ElementStructure[]) {\n    return structures.findIndex(\n        ({ dataset: { key } }) => key === selectedProperty,\n    );\n}\n\nexport function createElement(structure: ElementStructure) {\n    const { selector, dataset, attr, style, html } = structure;\n\n    const classNames = selector.match(/\\.([^.#\\s])+/g) || [];\n    const tag = (selector.match(/^[^.#\\s]+/g) || [])[0] || \"div\";\n    const id = (selector.match(/#[^.#\\s]+/g) || [])[0] || \"\";\n    const el = document.createElement(tag);\n\n    id && (el.id = id.replace(/^#/g, \"\"));\n    el.className = classNames.map(name => `${PREFIX}${name.replace(/^\\./g, \"\")}`).join(\" \");\n\n    if (dataset) {\n        for (const name in dataset) {\n            el.setAttribute(`data-${name}`, dataset[name]);\n        }\n    }\n    if (attr) {\n        for (const name in attr) {\n            el.setAttribute(name, attr[name]);\n        }\n    }\n    if (style) {\n        applyStyle(el, style);\n    }\n    if (html) {\n        el.innerHTML = html;\n    }\n    return el;\n}\nexport function updateElement(prevStructure: ElementStructure, nextStructure: ElementStructure) {\n    const { dataset, attr, style, html, element } = nextStructure;\n    if (dataset) {\n        for (const name in dataset) {\n            element.setAttribute(`data-${name}`, dataset[name]);\n        }\n    }\n    if (attr) {\n        for (const name in attr) {\n            element.setAttribute(name, attr[name]);\n        }\n    }\n    style && applyStyle(element, style);\n    if (prevStructure.html !== nextStructure.html) {\n        element.innerHTML = html;\n    }\n}\nexport function keys(value: object) {\n    const arr = [];\n    for (const name in value) {\n        arr.push(name);\n    }\n    return arr;\n}\nexport function toValue(value: any) {\n    const type = typeof value;\n    if (type === \"object\") {\n        if (Array.isArray(value)) {\n            return `[${value.join(\", \")}]`;\n        }\n        return `{${keys(value).map(k => `${k}: ${toValue(value[k])}`).join(\", \")}}`;\n    }\n    return value;\n}\nexport function flatObject(obj: IObject<any>, newObj: IObject<any> = {}) {\n\n    for (const name in obj) {\n        const value = obj[name];\n\n        if (isObject(value)) {\n            const nextObj = flatObject(isFrame(value) ? value.get() : value);\n\n            for (const nextName in nextObj) {\n                newObj[`${name}///${nextName}`] = nextObj[nextName];\n            }\n        } else {\n            newObj[name] = value;\n        }\n    }\n    return newObj;\n}\n\nexport function getTarget<T extends HTMLElement>(target: T, conditionCallback: (el: Element) => boolean): T {\n    let parentTarget = target;\n\n    while (parentTarget && parentTarget !== document.body) {\n        if (conditionCallback(parentTarget)) {\n            return parentTarget;\n        }\n        parentTarget = parentTarget.parentNode as T;\n    }\n    return null;\n}\n\nexport function hasClass(target: Element, className: string) {\n    return hasClass2(target, `${PREFIX}${className}`);\n}\nexport function addClass(target: Element, className: string) {\n    return addClass2(target, `${PREFIX}${className}`);\n}\nexport function removeClass(target: Element, className: string) {\n    return removeClass2(target, `${PREFIX}${className}`);\n}\nexport function findStructure(\n    selector: string,\n    structure: ElementStructure | ElementStructure[],\n    multi: true,\n    arr?: ElementStructure[],\n): ElementStructure[];\nexport function findStructure(\n    selector: string,\n    structure: ElementStructure | ElementStructure[],\n    multi?: false,\n    arr?: ElementStructure[],\n): ElementStructure;\nexport function findStructure(\n    selector: string,\n    structure: ElementStructure | ElementStructure[],\n    multi: true | false,\n    arr?: ElementStructure[],\n): ElementStructure | ElementStructure[];\nexport function findStructure(\n    selector: string,\n    structure: ElementStructure | ElementStructure[],\n    multi: boolean = false,\n    arr: ElementStructure[] = [],\n): ElementStructure | ElementStructure[] {\n    if (isArray(structure)) {\n        const length = structure.length;\n\n        for (let i = 0; i < length; ++i) {\n            findStructure(selector, structure[i], multi, arr);\n        }\n    } else {\n        if (structure.selector === selector) {\n            arr.push(structure);\n        }\n        if (!multi && arr.length) {\n            return arr[0];\n        }\n        if (structure.children) {\n            findStructure(selector, structure.children, multi, arr);\n        }\n    }\n    return multi ? arr : arr[0];\n}\nexport function isScene(value: any): value is Scene {\n    return !!(value.constructor as typeof Scene).prototype.getItem;\n}\nexport function isSceneItem(value: any): value is SceneItem {\n    return !!(value.constructor as typeof SceneItem).prototype.getFrame;\n}\nexport function isFrame(value: any): value is Frame {\n    return !!(value.constructor as typeof Frame).prototype.toCSS;\n}\nexport function splitProperty(scene: Scene, property: string) {\n    const names = property.split(\"///\");\n    const length = names.length;\n    let item: Scene | SceneItem = scene;\n    let i;\n\n    for (i = 0; i < length; ++i) {\n        if (isSceneItem(item)) {\n            break;\n        }\n        item = scene.getItem(names[i]);\n    }\n    return {\n        item: item as SceneItem,\n        names: names.slice(0, i),\n        properties: names.slice(i),\n    };\n}\nexport function getSceneItem(scene: Scene, names: string[]): SceneItem {\n    return names.reduce<any>(\n        (nextScene, name) => nextScene.getItem(name),\n        scene,\n    );\n}\n\nexport function findElementIndexByPosition(elements: HTMLElement[], pos: number): number {\n    const length = elements.length;\n\n    for (let index = 0; index < length; ++index) {\n        const el = elements[index];\n        const box = el.getBoundingClientRect();\n        const top = box.top;\n        const bottom = top + box.height;\n\n        if (top <= pos && pos < bottom) {\n            return index;\n        }\n    }\n    return -1;\n}\n","import { now } from \"@daybrush/utils\";\n\nlet prevTime = 0;\nlet prevX = -1;\nlet prevY = -1;\n\nexport function dblCheck(\n    isDrag: boolean,\n    e: any,\n    clientX: number,\n    clientY: number,\n    callback: (e: any, clientX: number, clientY: number) => void,\n) {\n    const currentTime = now();\n\n    if (!isDrag) {\n        if (\n            prevX === clientX &&\n            prevY === clientY &&\n            currentTime - prevTime <= 500\n        ) {\n            callback(e, clientX, clientY);\n        }\n        prevX = clientX;\n        prevY = clientY;\n        prevTime = currentTime;\n    }\n}\n","export function getKeytimesStructure(maxTime: number) {\n    const keytimes = [];\n\n    for (let time = 0; time <= maxTime; ++time) {\n        keytimes.push({\n            key: time,\n            dataset: {\n                time,\n            },\n            selector: \".keytime\",\n            style: {\n                width: `${100 / maxTime}%`,\n            },\n            children: [\n                {\n                    selector: \"span\",\n                    html: `${time}`,\n                },\n                {selector: \".graduation.start\"},\n                {selector: \".graduation.quarter\"},\n                {selector: \".graduation.half\"},\n                {selector: \".graduation.quarter3\"},\n            ],\n        });\n    }\n    return keytimes;\n}\nexport function getLinesStructure(maxTime: number) {\n    const lines = [];\n\n    for (let time = 0; time <= maxTime; ++time) {\n        lines.push({\n            key: time,\n            selector: \".division_line\",\n            style: {\n                left: `${100 / maxTime * time}%`,\n            },\n        });\n    }\n    return lines;\n}\n","import { getKeytimesStructure } from \"./KeytimesStructure\";\nimport { Ids, ElementStructure } from \"./types\";\n\nexport function getHeaderAreaStructure(ids: Ids, zoom: number, maxDuration: number, maxTime: number): ElementStructure {\n    return {\n        selector: \".header_area\",\n        ref: e => {\n            ids.keyframesScrollAreas = [];\n            ids.keyframesAreas = [];\n            ids.propertiesAreas = [];\n        },\n        children: [\n            {\n                ref: (e: ElementStructure) => {\n                    ids.propertiesAreas[0] = e;\n                },\n                selector: \".properties_area\",\n                children: [\n                    {\n                        selector: \".property\",\n                        html: \"Name\",\n                    },\n                ],\n            },\n            {\n                selector: \".values_area\",\n                children: {\n                    selector: \".value\",\n                    html: \"+\",\n                },\n            },\n            getKeytimesAreaStructure(ids, zoom, maxDuration, maxTime),\n        ],\n    };\n}\n\nexport function getKeytimesAreaStructure(\n    ids: Ids,\n    zoom: number,\n    maxDuration: number,\n    maxTime: number,\n): ElementStructure {\n    return {\n        ref: e => {\n            ids.keyframesAreas[0] = e;\n        },\n        selector: \".keyframes_area\",\n        children: {\n            style: {\n                minWidth: `${50 * maxTime}px`,\n                width: `${Math.min(maxDuration ? maxTime / maxDuration : 1, 2) * zoom * 100}%`,\n            },\n            dataset: {\n                width: Math.min(maxDuration ? maxTime / maxDuration : 1, 2),\n            },\n            ref: (e: ElementStructure) => {\n                ids.keyframesScrollAreas[0] = e;\n            },\n            selector: \".keyframes_scroll_area\",\n            children: {\n                ref: e => {\n                    ids.cursors = [];\n                },\n                selector: \".keyframes\",\n                children: [\n                    {\n                        ref: e => {\n                            ids.keytimesContainer = e;\n                        },\n                        selector: \".keyframes_container\",\n                        children: getKeytimesStructure(maxTime),\n                    },\n                    {\n                        selector: \".keyframe_cursor\",\n                        ref: e => {\n                            ids.cursors[0] = e;\n                        },\n                    },\n                ],\n            },\n        },\n    };\n}\n","import { toValue, applyStyle } from \"./utils\";\nimport { ElementStructure, Ids, TimelineInfo, PropertiesInfo } from \"./types\";\nimport { getLinesStructure } from \"./KeytimesStructure\";\nimport { isUndefined } from \"@daybrush/utils\";\n\nexport function updateKeyframesStructure(keyframes: ElementStructure[], maxTime: number) {\n    keyframes.forEach(keyframe => {\n        const {selector, dataset, style, element} = keyframe;\n        if (selector === \".keyframe\") {\n            style.left = `${dataset.time / maxTime * 100}%`;\n        } else {\n            style.left = `${dataset.from / maxTime * 100}%`,\n            style.width = `${(dataset.to - dataset.from) / maxTime * 100}%`;\n        }\n        applyStyle(element, style);\n    });\n}\n\nexport function getKeyframesAreaStructure(\n    ids: Ids,\n    keyframesList: ElementStructure[],\n    zoom: number,\n    maxDuration: number,\n    maxTime: number,\n): ElementStructure {\n    const width = Math.min(maxDuration ? maxTime / maxDuration : 1, 2);\n    return {\n        ref: e => {\n            ids.keyframesAreas[1] = e;\n        },\n        selector: \".keyframes_area\",\n        children: {\n            style: {\n                minWidth: `${50 * maxTime}px`,\n                width: `${width * zoom * 100}%`,\n            },\n            dataset: {\n                width,\n            },\n            ref: e => {\n                ids.keyframesScrollAreas[1] = e;\n            },\n            selector: \".keyframes_scroll_area\",\n            children: getKeyframesScrollAreaChildrenStructure(ids, keyframesList, maxTime),\n        },\n    };\n}\nexport function getKeyframesScrollAreaChildrenStructure(\n    ids: Ids,\n    keyframesList: ElementStructure[],\n    maxTime: number,\n): ElementStructure[] {\n    return [\n        ...keyframesList,\n        {\n            key: \"cursor\",\n            selector: \".keyframe_cursor\",\n            ref: e => {\n                ids.cursors[1] = e;\n            },\n        },\n        {\n            key: \"lineArea\",\n            ref: e => {\n                ids.lineArea = e;\n            },\n            selector: \".line_area\",\n            children: getLinesStructure(maxTime),\n        },\n    ];\n}\nexport function getKeyframesListStructure(\n    ids: Ids,\n    timelineInfo: TimelineInfo,\n    maxTime: number,\n): ElementStructure[] {\n    const keyframesList: ElementStructure[] = [];\n\n    for (const key in timelineInfo) {\n        const propertiesInfo = timelineInfo[key];\n        const keyframes = getKeyframesStructure(propertiesInfo, maxTime);\n\n        keyframesList.push({\n            ref: (e, i) => {\n                ids.keyframesList[i] = e;\n                ids.keyframesContainers[i] = e.children as ElementStructure;\n            },\n            selector: \".keyframes\",\n            key,\n            dataset: {\n                key,\n            },\n            datas: propertiesInfo,\n            children: {\n                selector: \".keyframes_container\",\n                children: keyframes,\n            },\n        });\n    }\n    return keyframesList;\n}\nexport function getDelayFrameStructure(\n    time: number,\n    nextTime: number,\n    maxTime: number,\n): ElementStructure {\n    return {\n        selector: \".keyframe_delay\",\n        key: `delay${time},${nextTime}`,\n        datas: {\n            time: -1,\n        },\n        style: {\n            left: `${time / maxTime * 100}%`,\n            width: `${(nextTime - time) / maxTime * 100}%`,\n        },\n    };\n}\nexport function getKeyframesStructure(\n    propertiesInfo: PropertiesInfo,\n    maxTime: number,\n): ElementStructure[] {\n    const keyframeLines: ElementStructure[] = [];\n    const duration = propertiesInfo.item.getDuration();\n    const frames = propertiesInfo.frames;\n    const delayFrames: ElementStructure[] = [];\n\n    const keyframes: ElementStructure[] = frames.map(([time, iterationTime, value], i): ElementStructure => {\n        const valueText = toValue(value);\n\n        if (frames[i + 1]) {\n            const [nextTime, nextIterationTime, nextValue] = frames[i + 1];\n            const nextValueText = toValue(nextValue);\n\n            if (\n                (iterationTime === 0 && nextIterationTime === 0)\n                || (iterationTime === duration && nextIterationTime === duration)\n            ) {\n                delayFrames.push(\n                    getDelayFrameStructure(time, nextTime, maxTime),\n                );\n            }\n            if (!isUndefined(value) && !isUndefined(nextValue) && valueText !== nextValueText) {\n                keyframeLines.push({\n                    selector: \".keyframe_line\",\n                    key: `${time},${nextTime}`,\n                    datas: {\n                        time: `${time},${nextTime}`,\n                        from: time,\n                        to: nextTime,\n                    },\n                    style: {\n                        left: `${time / maxTime * 100}%`,\n                        width: `${(nextTime - time) / maxTime * 100}%`,\n                    },\n                });\n            }\n        }\n\n        return {\n            key: time,\n            selector: \".keyframe\",\n            dataset: {\n                time,\n            },\n            datas: {\n                time,\n                iterationTime,\n                value: valueText,\n            },\n            style: {\n                left: `${time / maxTime * 100}%`,\n            },\n            html: `${time} ${valueText}`,\n        };\n    });\n\n    return [...keyframes, ...delayFrames, ...keyframeLines];\n}\n","import { ElementStructure, Ids, TimelineInfo } from \"./types\";\n\nexport function getPropertiesStructure(ids: Ids, timelineInfo: TimelineInfo) {\n    const properties: ElementStructure[] = [];\n\n    for (const key in timelineInfo) {\n        const propertiesInfo = timelineInfo[key];\n        const propertyNames = key.split(\"///\");\n        const length = propertyNames.length;\n        const id = propertyNames[length - 1];\n\n        properties.push({\n            ref: (e, i) => {\n                ids.properties[i] = e;\n            },\n            key,\n            selector: \".property\",\n            dataset: {\n                key,\n                object: propertiesInfo.isParent ? \"1\" : \"0\",\n            },\n            datas: propertiesInfo,\n            style: {\n                paddingLeft: `${10 + (length - 1) * 20}px`,\n            },\n            children: [\n                { selector: \".arrow\"},\n                {\n                    selector: \"span\",\n                    html: id,\n                },\n            ],\n        });\n    }\n    return properties;\n}\n","import { isObject } from \"@daybrush/utils\";\nimport { Ids, ElementStructure, TimelineInfo } from \"./types\";\n\nexport function getValuesStructure(ids: Ids, timelineInfo: TimelineInfo): ElementStructure[] {\n    const values: ElementStructure[] = [];\n\n    for (const key in timelineInfo) {\n        const propertiesInfo = timelineInfo[key];\n        const frames = propertiesInfo.frames;\n        values.push({\n            ref: (e, i) => {\n                ids.values[i] = e;\n            },\n            key,\n            selector: \".value\",\n            dataset: {\n                key,\n                object: propertiesInfo.isParent ? \"1\" : \"0\",\n            },\n            datas: propertiesInfo,\n            children: {\n                selector: \"input\",\n                attr: {\n                    value: frames[0] ? frames[0][1] : \"\",\n                },\n            },\n        });\n    }\n    return values;\n}\n","import { getKeyframesAreaStructure, getKeyframesListStructure } from \"./KeyframesStructure\";\nimport { ElementStructure, Ids, TimelineInfo } from \"./types\";\nimport { getPropertiesStructure } from \"./PropertiesStructure\";\nimport { getValuesStructure } from \"./ValuesStructure\";\n\nexport function getScrollAreaStructure(\n    ids: Ids,\n    timelineInfo: TimelineInfo,\n    zoom: number,\n    maxDuration: number,\n    maxTime: number,\n): ElementStructure {\n    const keyframesList: ElementStructure[] = getKeyframesListStructure(ids, timelineInfo, maxTime);\n\n    return {\n        ref: e => {\n            ids.scrollArea = e;\n            ids.keyframesList = [];\n            ids.keyframesContainers = [];\n        },\n        selector: \".scroll_area\",\n        children: [\n            {\n                ref: e => {\n                    ids.propertiesAreas[1] = e;\n                    ids.properties = [];\n                },\n                selector: \".properties_area\",\n                children: [\n                    {\n                        selector: \".properties_scroll_area\",\n                        children: getPropertiesStructure(ids, timelineInfo),\n                    },\n                ],\n            },\n            {\n                ref: e => {\n                    ids.valuesArea = e;\n                    ids.values = [];\n                },\n                selector: \".values_area\",\n                children: getValuesStructure(ids, timelineInfo),\n            },\n            getKeyframesAreaStructure(ids, keyframesList, zoom, maxDuration, maxTime),\n        ],\n    };\n}\n","import { Ids, ElementStructure } from \"./types\";\n\nexport function getControlAreaStructure(ids: Ids): ElementStructure {\n    return {\n        selector: \".header_area.control_area\",\n        children: [\n            {\n                selector: \".properties_area\",\n                ref: (e: ElementStructure) => {\n                    ids.unselectedArea = e;\n                },\n                children: {\n                    selector: \".property\",\n                },\n            },\n            {\n                selector: \".values_area\",\n                children: {\n                    selector: \".value\",\n                },\n            },\n            {\n                selector: \".keyframes_area\",\n                children: {\n                    selector: \".keyframes\",\n                    children: [\n                        {\n                            selector: \"input.time_area\",\n                            ref: (e: ElementStructure) => {\n                                ids.timeArea = e;\n                            },\n                            html: \"???\",\n                            // html: \"0\",\n                        },\n                        {\n                            selector: \".play_control_area\",\n                            children: [\n                                {\n                                    ref: (e: ElementStructure) => {\n                                        ids.prevBtn = e;\n                                    },\n                                    selector: \".control.prev\",\n                                },\n                                {\n                                    ref: (e: ElementStructure) => {\n                                        ids.playBtn = e;\n                                    },\n                                    selector: \".control.play\",\n                                },\n                                {\n                                    ref: (e: ElementStructure) => {\n                                        ids.nextBtn = e;\n                                    },\n                                    selector: \".control.next\",\n                                },\n                            ],\n                        },\n                    ],\n                },\n            },\n        ],\n    };\n}\n","import Timeline from \"./Timeline\";\nimport Scene, { SceneItem, Animator, DirectionType } from \"scenejs\";\nimport { createElement, updateElement, getTarget, isSceneItem } from \"./utils\";\nimport DataDOM, { DataStructure } from \"data-dom\";\nimport { ElementStructure } from \"./types\";\nimport { CSS2 } from \"./consts\";\nimport { isUndefined } from \"@daybrush/utils\";\nimport KeyController from \"keycon\";\n\nexport interface SelectEvent {\n    selectedItem: Scene | SceneItem;\n    selectedProperty: string;\n    selectedTime: number;\n    prevSelectedProperty: string;\n    prevSelectedTime: number;\n}\nexport function getOptionAreaStructure(option: string, value: any): ElementStructure {\n    return {\n        selector: \".option_area\",\n        children: [\n            {\n                selector: \".option_name\",\n                html: option,\n            },\n            {\n                selector: \".option_value\",\n                dataset: {\n                    option,\n                },\n                children: {\n                    selector: \"input\",\n                    dataset: {\n                        option,\n                    },\n                    ref: e => {\n                        (e.element as HTMLInputElement).value = isUndefined(value) ? \"\" : value;\n                    },\n                },\n            },\n        ],\n    };\n}\nexport function getOptionsStructure(item?: Animator): ElementStructure[] {\n    return [\n        getOptionAreaStructure(\"delay\", item && item.getDelay()),\n        getOptionAreaStructure(\"easing\", item && item.getEasingName()),\n        getOptionAreaStructure(\"iterationCount\", item && item.getIterationCount()),\n        getOptionAreaStructure(\"playSpeed\", item && item.getPlaySpeed()),\n        getOptionAreaStructure(\"fillMode\", item && item.getFillMode()),\n        getOptionAreaStructure(\"direction\", item && item.getDirection()),\n        getOptionAreaStructure(\"duration\", item && item.getDuration()),\n        getOptionAreaStructure(\"lastFrame\", item && item.getDuration()),\n    ];\n}\nexport class Info {\n    private datadom: DataDOM<ElementStructure>;\n    private optionArea: ElementStructure;\n    private infoArea: ElementStructure;\n    private selectedItem: Scene | SceneItem;\n    constructor(private timeline: Timeline, parentEl: HTMLElement) {\n        timeline.on(\"select\", this.select);\n\n        this.datadom = new DataDOM(\n            createElement,\n            updateElement,\n        );\n        this.selectedItem = timeline.scene;\n\n        this.infoArea = this.datadom.render(\n            {\n                selector: \".item_info\",\n                children: [\n                    {\n                        selector: \"style\",\n                        html: CSS2,\n                    },\n                    {\n                        ref: (e: ElementStructure) => {\n                            this.optionArea = e;\n                        },\n                        selector: \".options_area\",\n                        children: getOptionsStructure(timeline.scene),\n                    },\n                ],\n            },\n            parentEl,\n        );\n        this.init();\n    }\n    public update() {\n        this.datadom.update(\n            this.optionArea.children,\n            getOptionsStructure(this.selectedItem),\n            this.optionArea,\n        );\n    }\n    public select = (info: SelectEvent) => {\n        this.selectedItem = info.selectedItem;\n        this.update();\n    }\n    private init() {\n        new KeyController(this.infoArea.element)\n        .keydown(e => {\n            e.inputEvent.stopPropagation();\n        })\n        .keyup(e => {\n            e.inputEvent.stopPropagation();\n        })\n        .keyup(\"enter\", e => {\n            const selectedItem = this.selectedItem;\n            if (!this.selectedItem) {\n                return;\n            }\n            const target = getTarget(e.inputEvent.target as HTMLInputElement, el => el.nodeName === \"INPUT\");\n\n            if (!target) {\n                return;\n            }\n            const option = target.getAttribute(\"data-option\");\n            const value = target.value;\n\n            if (option === \"delay\") {\n                selectedItem.setDelay(parseFloat(value));\n            } else if (option === \"lastFrame\") {\n                const nextDuration = parseFloat(value);\n                if (isSceneItem(selectedItem) && selectedItem.getDuration() < nextDuration) {\n                    selectedItem.newFrame(nextDuration);\n                }\n            } else if (option === \"playSpeed\") {\n                selectedItem.setPlaySpeed(parseFloat(value));\n            } else if (option === \"direction\") {\n                selectedItem.setDirection(value as DirectionType);\n            } else if (option === \"iterationCount\") {\n                selectedItem.setIterationCount(value === \"infinite\" ? value : parseFloat(value));\n            } else if (option === \"easing\") {\n                selectedItem.setEasing(value);\n            }\n            this.timeline.update();\n            this.update();\n        });\n    }\n}\n","import Scene, { AnimatorState, SceneItem } from \"scenejs\";\nimport { ITERATION_COUNT, DELAY, PLAY_SPEED, DIRECTION, REVERSE, ALTERNATE, ALTERNATE_REVERSE } from \"./consts\";\nimport { TimelineInfo } from \"./types\";\nimport { isScene } from \"./utils\";\nimport { isUndefined, isObject } from \"@daybrush/utils\";\n\nexport const MAXIMUM = 1000000;\nexport function toFixed(num: number) {\n    return Math.round(num * MAXIMUM) / MAXIMUM;\n}\nexport function addEntry(entries: number[][], time: number, keytime: number) {\n    const prevEntry = entries[entries.length - 1];\n\n    (!prevEntry || prevEntry[0] !== time || prevEntry[1] !== keytime) &&\n        entries.push([toFixed(time), toFixed(keytime)]);\n}\nexport function dotNumber(a1: number, a2: number, b1: number, b2: number) {\n    return (a1 * b2 + a2 * b1) / (b1 + b2);\n  }\nexport function getEntries(times: number[], states: AnimatorState[]) {\n    let entries = times.map(time => ([time, time]));\n    let nextEntries = [];\n\n    states.forEach(state => {\n        const iterationCount = state[ITERATION_COUNT] as number;\n        const delay = state[DELAY];\n        const playSpeed = state[PLAY_SPEED];\n        const direction = state[DIRECTION];\n        const intCount = Math.ceil(iterationCount);\n        const currentDuration = entries[entries.length - 1][0];\n        const length = entries.length;\n        const lastTime = currentDuration * iterationCount;\n\n        for (let i = 0; i < intCount; ++i) {\n            const isReverse =\n                direction === REVERSE ||\n                direction === ALTERNATE && i % 2 ||\n                direction === ALTERNATE_REVERSE && !(i % 2);\n\n            for (let j = 0; j < length; ++j) {\n                const entry = entries[isReverse ? length - j - 1 : j];\n                const time = entry[1];\n                const currentTime = currentDuration * i + (isReverse ? currentDuration - entry[0] : entry[0]);\n                const prevEntry = entries[isReverse ? length - j : j - 1];\n\n                if (currentTime > lastTime) {\n                    if (j !== 0) {\n                        const prevTime = currentDuration * i +\n                            (isReverse ? currentDuration - prevEntry[0] : prevEntry[0]);\n                        const divideTime = dotNumber(prevEntry[1], time, lastTime - prevTime, currentTime - lastTime);\n\n                        addEntry(nextEntries, (delay + currentDuration * iterationCount) / playSpeed, divideTime);\n                    }\n                    break;\n                } else if (currentTime === lastTime && nextEntries[nextEntries.length - 1][0] === lastTime + delay) {\n                    break;\n                }\n                addEntry(nextEntries, (delay + currentTime) / playSpeed, time);\n            }\n        }\n        // delay time\n        delay && nextEntries.unshift([0, nextEntries[0][1]]);\n\n        entries = nextEntries;\n        nextEntries = [];\n    });\n\n    return entries;\n}\nexport function getItemInfo(\n    timelineInfo: TimelineInfo,\n    items: Array<Scene | SceneItem>,\n    names: Array<string | number>,\n    item: SceneItem) {\n    item.update();\n    const times = item.times;\n    const entries = getEntries(times, items.map(animator => animator.state));\n\n    (function getPropertyInfo(itemNames: any, ...properties: any[]) {\n        const frames = [];\n        const isParent = isObject(itemNames);\n        entries.forEach(([time, iterationTime]) => {\n            const value = item.get(iterationTime, ...properties);\n            if (isUndefined(value)) {\n                return;\n            }\n            frames.push([time, iterationTime, value]);\n        });\n        timelineInfo[[...names, ...properties].join(\"///\")] = {\n            isParent,\n            item,\n            names,\n            properties,\n            frames,\n        };\n        if (isParent) {\n            for (const property in itemNames) {\n                getPropertyInfo(itemNames[property], ...properties, property);\n            }\n        }\n    })(item.names);\n}\nexport function getTimelineInfo(scene: Scene): TimelineInfo {\n    const timelineInfo: TimelineInfo = {};\n    (function sceneForEach(...items: Array<Scene | SceneItem>) {\n        const lastItem = items[items.length - 1];\n        const names = items.slice(1).map(item => item.getId());\n        if (isScene(lastItem)) {\n            if (names.length) {\n                timelineInfo[names.join(\"///\")] = {\n                    isParent: true,\n                    item: lastItem,\n                    names: [],\n                    properties: [],\n                    frames: [],\n                };\n            }\n            lastItem.forEach((item: Scene | SceneItem) => {\n                sceneForEach(...items, item);\n            });\n        } else {\n            getItemInfo(timelineInfo, items, names, lastItem);\n        }\n    })(scene);\n\n    return timelineInfo;\n}\n","import Scene, { SceneItem } from \"scenejs\";\nimport {\n    getTarget,\n    hasClass, removeClass, addClass,\n    flatObject, splitProperty, findElementIndexByPosition,\n    createElement, updateElement, findIndexByProperty, findStructure, numberFormat, isScene,\n} from \"./utils\";\nimport { drag } from \"@daybrush/drag\";\nimport { CSS } from \"./consts\";\nimport { IObject, addEvent } from \"@daybrush/utils\";\nimport Axes, { PinchInput } from \"@egjs/axes\";\nimport { ElementStructure, Ids, PropertiesInfo, TimelineInfo } from \"./types\";\nimport { dblCheck } from \"./dblcheck\";\nimport KeyController from \"keycon\";\nimport DataDOM from \"data-dom\";\nimport { getHeaderAreaStructure, getKeytimesAreaStructure } from \"./HeaderAreaStructure\";\nimport { getScrollAreaStructure } from \"./ScrollAreaStructure\";\nimport { getControlAreaStructure } from \"./ControlAreaStructure\";\nimport Component from \"@egjs/component\";\nimport { Info } from \"./Info\";\nimport { getTimelineInfo } from \"./TimelineInfo\";\n\nlet isExportCSS = false;\n\nexport default class Timeline extends Component {\n    public scene: Scene;\n    private maxTime: number = 0;\n    private axes: Axes;\n    private selectedProperty: string = \"\";\n    private selectedTime: number = -1;\n    private keycon: KeyController;\n    private datadom: DataDOM<ElementStructure>;\n    private structure: ElementStructure;\n    private ids: Ids = {};\n    private timelineInfo: TimelineInfo;\n    constructor(scene: Scene, parentEl: HTMLElement) {\n        super();\n\n        scene.finish();\n        this.scene = scene;\n        this.initStructure(scene, parentEl);\n        this.initEditor();\n        this.initScroll();\n        this.initWheelZoom();\n        this.initDragKeyframes();\n        this.initClickProperty();\n        this.initController();\n        this.initDragValues();\n        this.initKeyController();\n\n        scene.setTime(0);\n\n        new Info(this, parentEl);\n    }\n    public getElement() {\n        return this.structure.element;\n    }\n    // scene control\n    public prev() {\n        this.scene.setTime(this.scene.getTime() - 0.05);\n    }\n    public next() {\n        this.scene.setTime(this.scene.getTime() + 0.05);\n    }\n    public finish() {\n        this.scene.finish();\n    }\n    public togglePlay() {\n        const scene = this.scene;\n        if (scene.getPlayState() === \"running\") {\n            scene.pause();\n        } else {\n            scene.play();\n        }\n    }\n    public update() {\n        const scene = this.scene;\n        this.timelineInfo = getTimelineInfo(scene);\n        const maxDuration = Math.ceil(scene.getDuration());\n        const maxTime = maxDuration;\n        let zoom = this.axes.get([\"zoom\"]).zoom;\n        const currentMaxTime = this.maxTime;\n        this.maxTime = maxTime;\n        const ids = this.ids;\n        const prevKeytimesArea = ids.keyframesAreas[0];\n        const nextZoom = currentMaxTime > 5 ? maxDuration / currentMaxTime : 1;\n\n        zoom = zoom * nextZoom;\n        this.axes.axm.set({ zoom });\n        // update keytimes\n        this.datadom.update(\n            prevKeytimesArea,\n            getKeytimesAreaStructure(ids, zoom, maxDuration, maxTime),\n        );\n\n        const nextScrollAreaStructure = getScrollAreaStructure(\n            ids,\n            this.timelineInfo,\n            this.axes.get([\"zoom\"]).zoom,\n            maxDuration, this.maxTime,\n        );\n\n        this.datadom.update(\n            ids.scrollArea,\n            nextScrollAreaStructure,\n        );\n        scene.setTime(scene.getTime());\n    }\n    // init\n    private initController() {\n        const ids = this.ids;\n        const playBtn = this.ids.playBtn.element;\n        const scene = this.scene;\n\n        playBtn.addEventListener(\"click\", e => {\n            this.togglePlay();\n            e.preventDefault();\n        });\n        ids.unselectedArea.element.addEventListener(\"click\", e => {\n            this.select(\"\", -1);\n        });\n        ids.prevBtn.element.addEventListener(\"click\", e => {\n            this.prev();\n            e.preventDefault();\n        });\n        ids.nextBtn.element.addEventListener(\"click\", e => {\n            this.next();\n            e.preventDefault();\n        });\n        scene.on(\"play\", () => {\n            addClass(playBtn, \"pause\");\n            removeClass(playBtn, \"play\");\n            // playBtn.innerHTML = \"pause\";\n        });\n        scene.on(\"paused\", () => {\n            addClass(playBtn, \"play\");\n            removeClass(playBtn, \"pause\");\n            // playBtn.innerHTML = \"play\";\n        });\n        new KeyController(ids.timeArea.element)\n        .keydown(e => {\n            !e.isToggle && e.inputEvent.stopPropagation();\n        })\n        .keyup(e => {\n            !e.isToggle && e.inputEvent.stopPropagation();\n        })\n        .keyup(\"enter\", e => {\n            // go to time\n            const element = ids.timeArea.element;\n            const value = (element as HTMLInputElement).value;\n            const result = /(\\d+):(\\d+):(\\d+)/g.exec(value);\n\n            if (!result) {\n                return;\n            }\n            const minute = parseFloat(result[1]);\n            const second = parseFloat(result[2]);\n            const milisecond = parseFloat(`0.${result[3]}`);\n            const time = minute * 60 + second + milisecond;\n\n            scene.setTime(time);\n        });\n    }\n    private initKeyController() {\n        const ids = this.ids;\n\n        window.addEventListener(\"blur\", () => {\n            removeClass(ids.timeline.element, \"alt\");\n        });\n        this.keycon = new KeyController()\n        .keydown(\"space\", ({inputEvent}) => {\n            inputEvent.preventDefault();\n        })\n        .keydown(\"left\", e => {\n            this.prev();\n        })\n        .keydown(\"right\", e => {\n            this.next();\n        })\n        .keyup(\"backspace\", () => {\n            this.removeKeyframe(this.selectedProperty);\n        })\n        .keydown(\"alt\", () => {\n            addClass(ids.timeline.element, \"alt\");\n        })\n        .keyup(\"alt\", () => {\n            removeClass(ids.timeline.element, \"alt\");\n        })\n        .keyup(\"esc\", () => {\n            this.finish();\n        })\n        .keyup(\"space\", () => {\n            this.togglePlay();\n        });\n    }\n    private initStructure(scene: Scene, parentEl: HTMLElement) {\n        this.timelineInfo = getTimelineInfo(scene);\n        const duration = Math.ceil(scene.getDuration());\n        const maxDuration = Math.ceil(duration);\n        const maxTime = maxDuration;\n        const ids = this.ids;\n        let timelineCSS: ElementStructure;\n\n        this.maxTime = maxTime;\n        if (!isExportCSS) {\n            timelineCSS = {\n                selector: \"style.style\",\n                html: CSS,\n            };\n            isExportCSS = true;\n        }\n\n        const structure: ElementStructure = {\n            selector: \".timeline\",\n            ref: e => {\n                ids.timeline = e;\n            },\n            children: [\n                timelineCSS,\n                getControlAreaStructure(ids),\n                getHeaderAreaStructure(ids, 1, maxDuration, maxTime),\n                getScrollAreaStructure(ids, this.timelineInfo, 1, maxDuration, maxTime),\n            ],\n        };\n        this.datadom = new DataDOM(\n            createElement,\n            updateElement,\n        );\n        this.structure = this.datadom.render(structure, parentEl);\n    }\n    private initScroll() {\n        const {\n            keyframesAreas,\n        } = this.ids;\n        let isScrollKeyframe = false;\n\n        const headerKeyframesArea = keyframesAreas[0].element;\n        const scrollKeyframesArea = keyframesAreas[1].element;\n        headerKeyframesArea.addEventListener(\"scroll\", () => {\n            if (isScrollKeyframe) {\n                isScrollKeyframe = false;\n            } else {\n                isScrollKeyframe = true;\n                scrollKeyframesArea.scrollLeft = headerKeyframesArea.scrollLeft;\n            }\n        });\n        scrollKeyframesArea.addEventListener(\"scroll\", () => {\n            if (isScrollKeyframe) {\n                isScrollKeyframe = false;\n            } else {\n                isScrollKeyframe = true;\n                headerKeyframesArea.scrollLeft = scrollKeyframesArea.scrollLeft;\n            }\n        });\n    }\n    private initWheelZoom() {\n        const ids = this.ids;\n        const keyframesScrollAreas = ids.keyframesScrollAreas;\n        const headerArea = keyframesScrollAreas[0].element;\n        const scrollArea = keyframesScrollAreas[1].element;\n\n        const axes = new Axes(\n            {\n                zoom: {\n                    range: [1, Infinity],\n                },\n            },\n            {},\n            { zoom: 1 },\n        );\n        axes.connect(\"zoom\", new PinchInput(scrollArea, {\n            scale: 0.1,\n            hammerManagerOptions: {\n                touchAction: \"auto\",\n            },\n        }));\n        axes.on(\"hold\", e => {\n            if (e.inputEvent) {\n                e.inputEvent.preventDefault();\n            }\n        });\n        axes.on(\"change\", e => {\n            const scale = ids.keyframesScrollAreas[0].dataset.width;\n            const width = e.pos.zoom * scale * 100;\n\n            ids.keyframesScrollAreas.forEach(({ element }) => {\n                element.style.width = `${width}%`;\n            });\n\n            if (e.inputEvent) {\n                e.inputEvent.preventDefault();\n            }\n        });\n\n        this.axes = axes;\n        headerArea.addEventListener(\"wheel\", e => {\n            const delta = e.deltaY;\n\n            axes.setBy({ zoom: delta / 5000 });\n            !e.deltaX && e.preventDefault();\n        });\n\n        addEvent(scrollArea, \"wheel\", e => {\n            if (!this.keycon.altKey) {\n                return;\n            }\n            e.preventDefault();\n            const delta = e.deltaY;\n\n            axes.setBy({ zoom: delta / 5000 });\n        });\n    }\n    private select(selectedProperty: string, keyframeTime?: number) {\n        const prevSelectedProperty = this.selectedProperty;\n        const prevSelectedTime = this.selectedTime;\n        const ids = this.ids;\n        const values = ids.values;\n        const properties = ids.properties;\n        const keyframesList = ids.keyframesList;\n\n        this.selectedProperty = selectedProperty;\n        this.scene.pause();\n        if (prevSelectedProperty) {\n            const prevSelectedIndex = findIndexByProperty(prevSelectedProperty, properties);\n\n            removeClass(properties[prevSelectedIndex].element, \"select\");\n            removeClass(values[prevSelectedIndex].element, \"select\");\n            removeClass(keyframesList[prevSelectedIndex].element, \"select\");\n\n            if (prevSelectedTime >= 0) {\n                const keyframes = ids.keyframesContainers[prevSelectedIndex].children as ElementStructure[];\n\n                keyframes.forEach(keyframe => {\n                    if (keyframe.datas.time === prevSelectedTime) {\n                        removeClass(keyframe.element, \"select\");\n                    }\n                });\n                this.selectedTime = -1;\n            }\n        }\n        let selectedItem: Scene | SceneItem = this.scene;\n        if (selectedProperty) {\n            if (document.activeElement) {\n                (document.activeElement as HTMLElement).blur();\n            }\n            const selectedIndex = findIndexByProperty(selectedProperty, properties);\n            addClass(properties[selectedIndex].element, \"select\");\n            addClass(values[selectedIndex].element, \"select\");\n            addClass(keyframesList[selectedIndex].element, \"select\");\n\n            selectedItem = (ids.keyframesList[selectedIndex].datas as PropertiesInfo).item;\n            if (keyframeTime >= 0) {\n                const selectedPropertyStructure = ids.keyframesContainers[selectedIndex];\n                const keyframes = selectedPropertyStructure.children as ElementStructure[];\n\n                keyframes.forEach(keyframe => {\n                    if (keyframe.datas.time === keyframeTime) {\n                        addClass(keyframe.element, \"select\");\n                    }\n                });\n                this.selectedTime = keyframeTime;\n            }\n        }\n        this.trigger(\"select\", {\n            selectedItem,\n            selectedProperty: this.selectedProperty,\n            selectedTime: this.selectedTime,\n            prevSelectedProperty,\n            prevSelectedTime,\n        });\n    }\n    private initClickProperty() {\n        const ids = this.ids;\n        const {\n            propertiesAreas,\n        } = ids;\n\n        propertiesAreas[1].element.addEventListener(\"click\", e => {\n            const properties = ids.properties.map(property => property.element);\n            const length = properties.length;\n            const arrow = getTarget(e.target as HTMLElement, el => hasClass(el, \"arrow\"));\n            const target = getTarget(e.target as HTMLElement, el => hasClass(el, \"property\"));\n\n            if (!target) {\n                return;\n            }\n            const index = properties.indexOf(target);\n\n            if (index === -1) {\n                return;\n            }\n            // select\n            if (!arrow) {\n                this.select(properties[index].dataset.key);\n                return;\n            }\n        });\n    }\n    private setInputs(obj: IObject<any>) {\n        const valuesArea = this.ids.valuesArea.element;\n        for (const name in obj) {\n            valuesArea.querySelector<HTMLInputElement>(`[data-key=\"${name}\"] input`).value = obj[name];\n        }\n    }\n    private moveCursor(time: number) {\n        const {cursors} = this.ids;\n        const maxTime = this.maxTime;\n        const px = 15 - 30 * time / maxTime;\n        const percent = 100 * time / maxTime;\n        const left = `calc(${percent}% + ${px}px)`;\n\n        cursors.forEach(cursor => {\n            cursor.element.style.left = left;\n        });\n    }\n    private initDragKeyframes() {\n        const ids = this.ids;\n        const {\n            scrollArea,\n            timeArea,\n            cursors,\n            keyframesAreas,\n            keyframesScrollAreas,\n        } = ids;\n        const scene = this.scene;\n\n        scene.on(\"animate\", e => {\n            const time = e.time;\n            this.moveCursor(time);\n\n            this.setInputs(flatObject(e.frames));\n            const minute = numberFormat(Math.floor(time / 60), 2);\n            const second = numberFormat(Math.floor(time % 60), 2);\n            const milisecond = numberFormat(Math.floor((time % 1) * 100), 3, true);\n            (timeArea.element as HTMLInputElement).value = `${minute}:${second}:${milisecond}`;\n        });\n        const getTime = (clientX: number) => {\n            const rect = keyframesScrollAreas[1].element.getBoundingClientRect();\n            const scrollAreaWidth = rect.width - 30;\n            const scrollAreaX = rect.left + 15;\n            const x = Math.min(scrollAreaWidth, Math.max(clientX - scrollAreaX, 0));\n            const percentage = x / scrollAreaWidth;\n            let time = this.maxTime * percentage;\n\n            time = Math.round(time * 20) / 20;\n\n            return time;\n        };\n        const move = (clientX: number) => {\n            scene.setTime(getTime(clientX));\n        };\n        const click = (e, clientX, clientY) => {\n            const target = getTarget(e.target as HTMLElement, el => hasClass(el, \"keyframe\"));\n            const time = target ? parseFloat(target.getAttribute(\"data-time\")) : getTime(clientX);\n\n            scene.setTime(time);\n            const list = ids.keyframesList;\n            const index = findElementIndexByPosition(\n                list.map(({element}) => element),\n                clientY,\n            );\n\n            if (index > -1) {\n                this.select(list[index].dataset.key, time);\n            }\n            e.preventDefault();\n        };\n        const dblclick = (e, clientX, clientY) => {\n            const list = ids.keyframesList;\n            const index = findElementIndexByPosition(\n                list.map(({element}) => element),\n                clientY,\n            );\n\n            if (index === -1) {\n                return;\n            }\n            this.addKeyframe(index, getTime(clientX));\n        };\n        drag(cursors[0].element, {\n            dragstart: ({inputEvent}) => {\n                inputEvent.stopPropagation();\n            },\n            drag: ({ clientX }) => {\n                move(clientX);\n            },\n            container: window,\n        });\n        keyframesScrollAreas.forEach(({ element }) => {\n            drag(element, {\n                container: window,\n                drag: ({ deltaX, deltaY, inputEvent }) => {\n                    keyframesAreas[1].element.scrollLeft -= deltaX;\n                    scrollArea.element.scrollTop -= deltaY;\n                    inputEvent.preventDefault();\n                },\n                dragend: ({ isDrag, clientX, clientY, inputEvent }) => {\n                    !isDrag && click(inputEvent, clientX, clientY);\n                    dblCheck(isDrag, inputEvent, clientX, clientY, dblclick);\n                },\n            });\n        });\n    }\n    private initDragValues() {\n        let dragTarget: HTMLInputElement = null;\n        let dragTargetValue: any;\n        drag(this.ids.valuesArea.element, {\n            container: window,\n            dragstart: e => {\n                dragTarget = e.inputEvent.target;\n                dragTargetValue = dragTarget.value;\n\n                console.log(this.keycon.altKey, getTarget(dragTarget, el => el.nodeName === \"INPUT\"));\n                if (!this.keycon.altKey || !getTarget(dragTarget, el => el.nodeName === \"INPUT\")) {\n                    return false;\n                }\n            },\n            drag: e => {\n                const nextValue = dragTargetValue.replace(/-?\\d+/g, num => {\n                    return `${parseFloat(num) + Math.round(e.distX / 2)}`;\n                });\n\n                dragTarget.value = nextValue;\n            },\n            dragend: e => {\n                this.edit(dragTarget, dragTarget.value);\n            },\n        });\n    }\n    private addKeyframe(index: number, time: number) {\n        const list = this.ids.keyframesList;\n        const property = list[index].dataset.key;\n        const {item, properties} = list[index].datas as PropertiesInfo;\n\n        this.select(property, time);\n\n        const value = ((this.ids.values[index].children as ElementStructure).element as HTMLInputElement).value;\n\n        this.editKeyframe(index, value);\n    }\n    private removeKeyframe(property: string) {\n        const propertiesInfo = this.timelineInfo[property];\n        if (!property || !propertiesInfo || isScene(propertiesInfo.item)) {\n            return;\n        }\n\n        const properties = propertiesInfo.properties;\n        const item = propertiesInfo.item;\n\n        item.remove(item.getIterationTime(), ...properties);\n        this.update();\n    }\n    private editKeyframe(index: number, value: any) {\n        const ids = this.ids;\n        const isObjectData = ids.properties[index].dataset.object === \"1\";\n\n        if (isObjectData) {\n            return;\n        }\n        const propertiesInfo = ids.keyframesList[index].datas as PropertiesInfo;\n        const item = propertiesInfo.item;\n        const properties = propertiesInfo.properties;\n\n        console.log(properties);\n        item.set(item.getIterationTime(), ...properties, value);\n        this.update();\n    }\n    private restoreKeyframes() {\n        this.scene.setTime(this.scene.getTime());\n    }\n    private edit(target: HTMLInputElement, value: any) {\n        const parentEl = getTarget(target, el => hasClass(el, \"value\"));\n\n        if (!parentEl) {\n            return;\n        }\n        const values = this.ids.values.map(({element}) => element);\n        const index = values.indexOf(parentEl);\n\n        if (index === -1) {\n            return;\n        }\n        this.editKeyframe(index, value);\n    }\n    private initEditor() {\n        const valuesArea = this.ids.valuesArea.element;\n\n        new KeyController(valuesArea)\n        .keydown(e => {\n            !e.isToggle && e.inputEvent.stopPropagation();\n        })\n        .keyup(e => {\n            !e.isToggle && e.inputEvent.stopPropagation();\n        })\n        .keyup(\"enter\", e => {\n            const target = e.inputEvent.target as HTMLInputElement;\n\n            this.edit(target, target.value);\n        })\n        .keyup(\"esc\", e => {\n            const target = e.inputEvent.target as HTMLInputElement;\n\n            target.blur();\n        });\n        valuesArea.addEventListener(\"focusout\", e => {\n            this.restoreKeyframes();\n        });\n    }\n}\n"],"names":["PREFIX","CSS2","replace","CSS","DIRECTION","ITERATION_COUNT","DELAY","PLAY_SPEED","ALTERNATE","REVERSE","ALTERNATE_REVERSE","numberFormat","num","count","isRight","length","arr","push","i","join","applyStyle","el","style","name","findIndexByProperty","selectedProperty","structures","findIndex","_a","key","createElement","structure","selector","dataset","attr","html","classNames","match","tag","id","document","className","map","setAttribute","innerHTML","updateElement","prevStructure","nextStructure","element","keys","value","toValue","type","Array","isArray","k","flatObject","obj","newObj","isObject","nextObj","isFrame","get","nextName","getTarget","target","conditionCallback","parentTarget","body","parentNode","hasClass","hasClass2","addClass","addClass2","removeClass","removeClass2","isScene","constructor","prototype","getItem","isSceneItem","getFrame","toCSS","findElementIndexByPosition","elements","pos","index","box","getBoundingClientRect","top","bottom","height","prevTime","prevX","prevY","dblCheck","isDrag","e","clientX","clientY","callback","currentTime","now","getKeytimesStructure","maxTime","keytimes","time","width","children","getLinesStructure","lines","left","getHeaderAreaStructure","ids","zoom","maxDuration","ref","keyframesScrollAreas","keyframesAreas","propertiesAreas","getKeytimesAreaStructure","minWidth","Math","min","cursors","keytimesContainer","getKeyframesAreaStructure","keyframesList","getKeyframesScrollAreaChildrenStructure","lineArea","getKeyframesListStructure","timelineInfo","propertiesInfo","keyframes","getKeyframesStructure","keyframesContainers","datas","getDelayFrameStructure","nextTime","keyframeLines","duration","item","getDuration","frames","delayFrames","iterationTime","valueText","_b","nextIterationTime","nextValue","nextValueText","isUndefined","from","to","getPropertiesStructure","properties","propertyNames","split","object","isParent","paddingLeft","getValuesStructure","values","getScrollAreaStructure","scrollArea","valuesArea","getControlAreaStructure","unselectedArea","timeArea","prevBtn","playBtn","nextBtn","getOptionAreaStructure","option","getOptionsStructure","getDelay","getEasingName","getIterationCount","getPlaySpeed","getFillMode","getDirection","timeline","parentEl","info","_this","selectedItem","update","on","select","datadom","DataDOM","scene","infoArea","render","optionArea","init","KeyController","keydown","inputEvent","stopPropagation","keyup","nodeName","getAttribute","setDelay","parseFloat","nextDuration","newFrame","setPlaySpeed","setDirection","setIterationCount","setEasing","MAXIMUM","toFixed","round","addEntry","entries","keytime","prevEntry","dotNumber","a1","a2","b1","b2","getEntries","times","states","nextEntries","forEach","state","iterationCount","delay","playSpeed","direction","intCount","ceil","currentDuration","lastTime","isReverse","j","entry","divideTime","unshift","getItemInfo","items","names","animator","getPropertyInfo","itemNames","_i","property","getTimelineInfo","sceneForEach","lastItem","slice","getId","isExportCSS","tslib_1","_super","finish","initStructure","initEditor","initScroll","initWheelZoom","initDragKeyframes","initClickProperty","initController","initDragValues","initKeyController","setTime","Info","getTime","getPlayState","pause","play","axes","currentMaxTime","prevKeytimesArea","nextZoom","axm","set","nextScrollAreaStructure","addEventListener","togglePlay","preventDefault","prev","next","isToggle","result","exec","minute","second","milisecond","window","keycon","removeKeyframe","timelineCSS","isScrollKeyframe","headerKeyframesArea","scrollKeyframesArea","scrollLeft","headerArea","Axes","range","Infinity","connect","PinchInput","scale","hammerManagerOptions","touchAction","delta","deltaY","setBy","deltaX","addEvent","altKey","keyframeTime","prevSelectedProperty","prevSelectedTime","selectedTime","prevSelectedIndex","keyframe","activeElement","blur","selectedIndex","selectedPropertyStructure","trigger","arrow","indexOf","querySelector","px","percent","cursor","moveCursor","setInputs","floor","rect","scrollAreaWidth","scrollAreaX","x","max","percentage","move","click","list","dblclick","addKeyframe","drag","dragstart","container","scrollTop","dragend","dragTarget","dragTargetValue","console","log","distX","edit","editKeyframe","remove","getIterationTime","isObjectData","restoreKeyframes","Component"],"mappings":"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"}